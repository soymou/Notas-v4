{"version":3,"sources":["../../src/core/define-plugin.ts","../../src/core/define-all-hooks-plugin.ts"],"sourcesContent":["import type { Plugin, PluginHooksConstraint } from \"./types.js\";\n\n/**\n * Allows defining a type-safe plugin that can be used in {defineIntegration}.\n *\n * @param {object} plugin\n * @param {string} plugin.name - The name of the plugin, as you want it to be called from the hook\n * @param {string} plugin.hook - The name of the hook where this plugin should be available\n * @param {Function} plugin.implementation - The actual function definition. Refer to docs for usage\n *\n * @see https://astro-integration-kit.netlify.app/core/define-plugin/\n *\n * ```ts\n * import { definePlugin } from \"../core/define-plugin.js\";\n * import { addVitePlugin } from \"../utilities/add-vite-plugin.js\";\n * import type { Plugin as VitePlugin } from \"vite\"\n *\n * export const addVitePluginPlugin = definePlugin({\n * \t\tname: \"addVitePlugin\",\n * \t\thook: \"astro:config:setup\",\n * \t\timplementation: ({ updateConfig }) => (plugin: VitePlugin) => addVitePlugin({ plugin, updateConfig }),\n * });\n * ```\n */\nexport const definePlugin = <\n\tTName extends string,\n\tTHooks extends PluginHooksConstraint,\n>(\n\tplugin: Plugin<TName, THooks>,\n) => plugin;\n","import { definePlugin } from \"./define-plugin.js\";\nimport type { Hooks, Plugin } from \"./types.js\";\n\nexport type AllHooksPluginDefinition<\n\tTName extends string,\n\tTApi extends Record<string, unknown>,\n> = {\n\tname: TName;\n\tsetup: (\n\t\t...params: Parameters<AllHooksPlugin<TName, TApi>[\"setup\"]>\n\t) => <H extends keyof Hooks>(\n\t\thookName: H,\n\t) => (...hookParams: Parameters<Hooks[H]>) => TApi;\n};\n\n/**\n * A plugin that exposes the same API for all hooks.\n */\nexport type AllHooksPlugin<\n\tTName extends string,\n\tTApi extends Record<string, unknown>,\n> = Plugin<TName, Record<keyof Hooks, TApi>>;\n\n/**\n * Allows defining a type-safe plugin that can be used from any Astro hook.\n *\n * This wraps {@link definePlugin} and receives a factory for the API to be\n * called dynamically for each hook. This allows plugins to support any hook\n * even those added by new versions of astro or hooks added by other integrations.\n *\n * @see https://astro-integration-kit.netlify.app/core/define-plugin/\n */\nexport const defineAllHooksPlugin = <\n\tTName extends string,\n\tTApi extends Record<string, unknown>,\n>(\n\tplugin: AllHooksPluginDefinition<TName, TApi>,\n): AllHooksPlugin<TName, TApi> =>\n\tdefinePlugin({\n\t\t...plugin,\n\t\tsetup: (...params) => {\n\t\t\tconst hookFactory = plugin.setup(...params);\n\n\t\t\treturn new Proxy(\n\t\t\t\tObject.freeze({}) as ReturnType<Plugin<any, any>[\"setup\"]>,\n\t\t\t\t{\n\t\t\t\t\thas: (_, prop) => typeof prop === \"string\",\n\t\t\t\t\tget: (_, prop) => hookFactory(prop as keyof Hooks),\n\t\t\t\t},\n\t\t\t);\n\t\t},\n\t});\n"],"mappings":"AAwBO,IAAMA,EAIZC,GACIA,ECGE,IAAMC,EAIZC,GAEAC,EAAa,CACZ,GAAGD,EACH,MAAO,IAAIE,IAAW,CACrB,IAAMC,EAAcH,EAAO,MAAM,GAAGE,CAAM,EAE1C,OAAO,IAAI,MACV,OAAO,OAAO,CAAC,CAAC,EAChB,CACC,IAAK,CAACE,EAAGC,IAAS,OAAOA,GAAS,SAClC,IAAK,CAACD,EAAGC,IAASF,EAAYE,CAAmB,CAClD,CACD,CACD,CACD,CAAC","names":["definePlugin","plugin","defineAllHooksPlugin","plugin","definePlugin","params","hookFactory","_","prop"]}