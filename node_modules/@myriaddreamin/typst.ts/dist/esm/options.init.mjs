/**
 * this mark is used to identify the beforeBuild stage
 * @description will not be used in runtime code
 */
const BeforeBuildSymbol = Symbol('beforeBuild');
/** @internal */
const _textFonts = [
    'DejaVuSansMono-Bold.ttf',
    'DejaVuSansMono-BoldOblique.ttf',
    'DejaVuSansMono-Oblique.ttf',
    'DejaVuSansMono.ttf',
    'LibertinusSerif-Bold.otf',
    'LibertinusSerif-BoldItalic.otf',
    'LibertinusSerif-Italic.otf',
    'LibertinusSerif-Regular.otf',
    'LibertinusSerif-Semibold.otf',
    'LibertinusSerif-SemiboldItalic.otf',
    'NewCM10-Bold.otf',
    'NewCM10-BoldItalic.otf',
    'NewCM10-Italic.otf',
    'NewCM10-Regular.otf',
    'NewCMMath-Bold.otf',
    'NewCMMath-Book.otf',
    'NewCMMath-Regular.otf',
];
/** @internal */
const _cjkFonts = [
    'InriaSerif-Bold.ttf',
    'InriaSerif-BoldItalic.ttf',
    'InriaSerif-Italic.ttf',
    'InriaSerif-Regular.ttf',
    'Roboto-Regular.ttf',
    'NotoSerifCJKsc-Regular.otf',
];
/** @internal */
const _emojiFonts = ['TwitterColorEmoji.ttf', 'NotoColorEmoji-Regular-COLR.subset.ttf'];
/**
 * disable default font assets
 */
export function disableDefaultFontAssets() {
    return preloadRemoteFonts([], { assets: false });
}
/**
 * preload font assets
 */
export function preloadFontAssets(options) {
    return preloadRemoteFonts([], options);
}
export function _resolveAssets(options) {
    const fonts = [];
    if (options &&
        options?.assets !== false &&
        options?.assets?.length &&
        options?.assets?.length > 0) {
        let defaultPrefix = {
            text: 'https://cdn.jsdelivr.net/gh/typst/typst-assets@v0.13.1/files/fonts/',
            _: 'https://cdn.jsdelivr.net/gh/typst/typst-dev-assets@v0.13.1/files/fonts/',
        };
        let assetUrlPrefix = options.assetUrlPrefix ?? defaultPrefix;
        if (typeof assetUrlPrefix === 'string') {
            assetUrlPrefix = { _: assetUrlPrefix };
        }
        else {
            assetUrlPrefix = { ...defaultPrefix, ...assetUrlPrefix };
        }
        for (const key of Object.keys(assetUrlPrefix)) {
            const u = assetUrlPrefix[key];
            if (u[u.length - 1] !== '/') {
                assetUrlPrefix[key] = u + '/';
            }
        }
        const prefix = (asset, f) => f.map(font => (assetUrlPrefix[asset] || assetUrlPrefix['_']) + font);
        for (const asset of options.assets) {
            switch (asset) {
                case 'text':
                    fonts.push(...prefix(asset, _textFonts));
                    break;
                case 'cjk':
                    fonts.push(...prefix(asset, _cjkFonts));
                    break;
                case 'emoji':
                    fonts.push(...prefix(asset, _emojiFonts));
                    break;
            }
        }
    }
    return fonts;
}
/**
 * preload remote fonts
 *
 * @param fonts - url path to font files
 * @returns {BeforeBuildFn}
 * @example
 * ```typescript
 * import { init, preloadRemoteFonts } from 'typst';
 * init({
 *   beforeBuild: [
 *     preloadRemoteFonts([
 *      'https://fonts.gstatic.com/s/roboto/v27/KFOmCnqEu92Fr1Mu4mxKKTU1Kg.woff2', // remote url
 *      'dist/fonts/Roboto-Regular.ttf', // relative to the root of the website
 *     ]),
 *   ],
 * });
 * ```
 */
export function preloadRemoteFonts(userFonts, options) {
    const assetFonts = _resolveAssets(options);
    const loader = async (_, { ref, builder }) => {
        if (options?.fetcher) {
            ref.setFetcher(options.fetcher);
        }
        await ref.loadFonts(builder, [...userFonts, ...assetFonts]);
    };
    loader._preloadRemoteFontOptions = options;
    loader._kind = 'fontLoader';
    return loader;
}
/**
 * preload system fonts
 * @param byFamily - filter system fonts to preload by family name
 * @returns {BeforeBuildFn}
 * @example
 * ```typescript
 * import { init, preloadSystemFonts } from 'typst';
 * init({
 *   beforeBuild: [
 *     preloadSystemFonts({
 *       byFamily: ['Roboto'], // preload fonts by family name
 *     }),
 *   ],
 * });
 * ```
 */
export function preloadSystemFonts({ byFamily }) {
    return async (_, { builder }) => {
        const t = performance.now();
        if ('queryLocalFonts' in window) {
            const fonts = await window.queryLocalFonts();
            byFamily = byFamily ?? [];
            for (const font of fonts) {
                if (!byFamily.includes(font.family)) {
                    continue;
                }
                const data = await (await font.blob()).arrayBuffer();
                await builder.add_raw_font(new Uint8Array(data));
            }
        }
        const t2 = performance.now();
        console.log('preload system font time used:', t2 - t);
    };
}
/**
 * (compile only) set pacoage registry
 *
 * @param accessModel: when compiling, the pacoage registry is used to access the
 * data of files
 * @returns {BeforeBuildFn}
 */
export function withPackageRegistry(packageRegistry) {
    return async (_, { builder }) => {
        return new Promise(resolve => {
            builder.set_package_registry(packageRegistry, function (spec) {
                return packageRegistry.resolve(spec, this);
            });
            resolve();
        });
    };
}
/**
 * (compile only) set access model
 *
 * @param accessModel: when compiling, the access model is used to access the
 * data of files
 * @returns {BeforeBuildFn}
 */
export function withAccessModel(accessModel) {
    return async (_, ctx) => {
        if (ctx.alreadySetAccessModel) {
            throw new Error(`already set some assess model before: ${ctx.alreadySetAccessModel.constructor?.name}(${ctx.alreadySetAccessModel})`);
        }
        ctx.alreadySetAccessModel = accessModel;
        return new Promise(resolve => {
            ctx.builder.set_access_model(accessModel, (path) => {
                const lastModified = accessModel.getMTime(path);
                if (lastModified) {
                    return lastModified.getTime();
                }
                return 0;
            }, (path) => {
                return accessModel.isFile(path) || false;
            }, (path) => {
                return accessModel.getRealPath(path) || path;
            }, (path) => {
                return accessModel.readAll(path);
            });
            resolve();
        });
    };
}
// todo: search browser
// searcher.search_browser().await?;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3B0aW9ucy5pbml0Lm1qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9vcHRpb25zLmluaXQubXRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQWFBOzs7R0FHRztBQUNILE1BQU0saUJBQWlCLEdBQWtCLE1BQU0sQ0FBQyxhQUFhLENBQUMsQ0FBQztBQWlEL0QsZ0JBQWdCO0FBQ2hCLE1BQU0sVUFBVSxHQUFhO0lBQzNCLHlCQUF5QjtJQUN6QixnQ0FBZ0M7SUFDaEMsNEJBQTRCO0lBQzVCLG9CQUFvQjtJQUNwQiwwQkFBMEI7SUFDMUIsZ0NBQWdDO0lBQ2hDLDRCQUE0QjtJQUM1Qiw2QkFBNkI7SUFDN0IsOEJBQThCO0lBQzlCLG9DQUFvQztJQUNwQyxrQkFBa0I7SUFDbEIsd0JBQXdCO0lBQ3hCLG9CQUFvQjtJQUNwQixxQkFBcUI7SUFDckIsb0JBQW9CO0lBQ3BCLG9CQUFvQjtJQUNwQix1QkFBdUI7Q0FDeEIsQ0FBQztBQUNGLGdCQUFnQjtBQUNoQixNQUFNLFNBQVMsR0FBYTtJQUMxQixxQkFBcUI7SUFDckIsMkJBQTJCO0lBQzNCLHVCQUF1QjtJQUN2Qix3QkFBd0I7SUFDeEIsb0JBQW9CO0lBQ3BCLDRCQUE0QjtDQUM3QixDQUFDO0FBQ0YsZ0JBQWdCO0FBQ2hCLE1BQU0sV0FBVyxHQUFhLENBQUMsdUJBQXVCLEVBQUUsd0NBQXdDLENBQUMsQ0FBQztBQW1DbEc7O0dBRUc7QUFDSCxNQUFNLFVBQVUsd0JBQXdCO0lBQ3RDLE9BQU8sa0JBQWtCLENBQUMsRUFBRSxFQUFFLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7QUFDbkQsQ0FBQztBQUVEOztHQUVHO0FBQ0gsTUFBTSxVQUFVLGlCQUFpQixDQUFDLE9BQWlDO0lBQ2pFLE9BQU8sa0JBQWtCLENBQUMsRUFBRSxFQUFFLE9BQU8sQ0FBQyxDQUFDO0FBQ3pDLENBQUM7QUFFRCxNQUFNLFVBQVUsY0FBYyxDQUFDLE9BQWdDO0lBQzdELE1BQU0sS0FBSyxH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QUM7WUFDL0MsQ0FBQyxFQUNELENBQUMsSUFBWSxFQUFFLEVBQUU7Z0JBQ2YsT0FBTyxXQUFXLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ25DLENBQUMsQ0FDRixDQUFDO1lBQ0YsT0FBTyxFQUFFLENBQUM7UUFDWixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQztBQUNKLENBQUM7QUFtQkQsdUJBQXVCO0FBQ3ZCLG9DQUFvQyIsInNvdXJjZXNDb250ZW50IjpbIi8vIEB0cy1pZ25vcmVcclxuaW1wb3J0IHR5cGUgKiBhcyB0eXBzdFJlbmRlcmVyIGZyb20gJ0BteXJpYWRkcmVhbWluL3R5cHN0LXRzLXJlbmRlcmVyJztcclxuaW1wb3J0IHR5cGUgKiBhcyB0eXBzdENvbXBpbGVyIGZyb20gJ0BteXJpYWRkcmVhbWluL3R5cHN0LXRzLXdlYi1jb21waWxlcic7XHJcbmltcG9ydCB0eXBlIHsgRnNBY2Nlc3NNb2RlbCwgUGFja2FnZVJlZ2lzdHJ5LCBQYWNrYWdlU3BlYyB9IGZyb20gJy4vaW50ZXJuYWwudHlwZXMubWpzJztcclxuaW1wb3J0IHR5cGUgeyBXZWJBc3NlbWJseU1vZHVsZVJlZiB9IGZyb20gJy4vd2FzbS5tanMnO1xyXG5cclxuLyoqXHJcbiAqIHN0YWdlZCBvcHRpb25zIGZ1bmN0aW9uXHJcbiAqIEB0ZW1wbGF0ZSBTIC0gc3RhZ2UgbWFya1xyXG4gKiBAdGVtcGxhdGUgVCAtIGNvbnRleHQgdHlwZVxyXG4gKi9cclxuZXhwb3J0IHR5cGUgU3RhZ2VkT3B0Rm48UyBleHRlbmRzIHN5bWJvbCwgVCA9IGFueT4gPSAoczogUywgdDogVCkgPT4gUHJvbWlzZTx2b2lkPjtcclxuXHJcbi8qKlxyXG4gKiB0aGlzIG1hcmsgaXMgdXNlZCB0byBpZGVudGlmeSB0aGUgYmVmb3JlQnVpbGQgc3RhZ2VcclxuICogQGRlc2NyaXB0aW9uIHdpbGwgbm90IGJlIHVzZWQgaW4gcnVudGltZSBjb2RlXHJcbiAqL1xyXG5jb25zdCBCZWZvcmVCdWlsZFN5bWJvbDogdW5pcXVlIHN5bWJvbCA9IFN5bWJvbCgnYmVmb3JlQnVpbGQnKTtcclxuXHJcbi8qKlxyXG4gKiB0aGlzIG1hcmsgaXMgdXNlZCB0byBpZGVudGlmeSB0aGUgYmVmb3JlQnVpbGQgc3RhZ2VcclxuICogQGRlc2NyaXB0aW9uIGNhbm5vdCBiZSBjcmVhdGVkIGJ5IGFueSBydW50aW1lIGNvZGVcclxuICovXHJcbmV4cG9ydCB0eXBlIEJlZm9yZUJ1aWxkTWFyayA9IHR5cGVvZiBCZWZvcmVCdWlsZFN5bWJvbDtcclxuXHJcbi8qKlxyXG4gKiBiZWZvcmUgYnVpbGQgc3RhZ2VcclxuICogQGRlc2NyaXB0aW9uIHBvc3NpYmxlIGNyZWF0ZWQgYnk6XHJcbiAqICAgLSBwcmVsb2FkUmVtb3RlRm9udHNcclxuICogICAtIHByZWxvYWRTeXN0ZW1Gb250c1xyXG4gKiAgIC0gd2l0aEFjY2Vzc01vZGVsXHJcbiAqICAgLSB3aXRoUGFja2FnZVJlZ2lzdHJ5XHJcbiAqL1xyXG5leHBvcnQgdHlwZSBCZWZvcmVCdWlsZEZuID0gU3RhZ2VkT3B0Rm48QmVmb3JlQnVpbGRNYXJrPjtcclxuXHJcbi8qKlxyXG4gKlxyXG4gKiBAcHJvcGVydHkge0JlZm9yZUJ1aWxkRm5bXX0gYmVmb3JlQnVpbGQgLSBjYWxsYmFja3MgYmVmb3JlIGJ1aWxkIHN0YWdlXHJcbiAqL1xyXG5leHBvcnQgaW50ZXJmYWNlIEluaXRPcHRpb25zIHtcclxuICAvKipcclxuICAgKiBjYWxsYmFja3MgYmVmb3JlIGJ1aWxkIHN0YWdlXHJcbiAgICpcclxuICAgKiBiZWZvcmUgYnVpbGQgc3RhZ2UsIHRoZSByZWdpc3RlcmVkIGZ1bmN0aW9ucyB3aWxsIGJlIGV4ZWN1dGVkIGluIG9yZGVyXHJcbiAgICogcG9zc2libGUgb3B0aW9uczpcclxuICAgKiAtIHByZWxvYWRSZW1vdGVGb250c1xyXG4gICAqIC0gcHJlbG9hZFN5c3RlbUZvbnRzXHJcbiAgICogLSB3aXRoQWNjZXNzTW9kZWxcclxuICAgKi9cclxuICBiZWZvcmVCdWlsZDogQmVmb3JlQnVpbGRGbltdO1xyXG5cclxuICAvKipcclxuICAgKiBjYWxsYmFja3MgdG8gZmV0Y2ggdGhlIHdhc20gbW9kdWxlIHdyYXBwZXJcclxuICAgKi9cclxuICBnZXRXcmFwcGVyPygpOiBQcm9taXNlPGFueT47XHJcblxyXG4gIC8qKlxyXG4gICAqIGNhbGxiYWNrcyB0byBmZXRjaCB0aGUgd2FzbSBtb2R1bGVcclxuICAgKlxyXG4gICAqIFRoZXJlIGFyZSBtYW55IHdheXMgdG8gcHJvdmlkZSBhIHdhc20gbW9kdWxlLCBzZWVcclxuICAgKiB7QGxpbmsgV2ViQXNzZW1ibHlNb2R1bGVSZWZ9IGZvciBtb3JlIGRldGFpbHMuIElmIHlvdSBkb24ndCBwcm92aWRlIGEgd2FzbVxyXG4gICAqIG1vZHVsZSwgdGhlIGRlZmF1bHQgbW9kdWxlIHdpbGwgYmUgdXNlZC5cclxuICAgKi9cclxuICBnZXRNb2R1bGUoKTogV2ViQXNzZW1ibHlNb2R1bGVSZWYgfCBQcm9taXNlPFdlYkFzc2VtYmx5TW9kdWxlUmVmPjtcclxufVxyXG5cclxuLyoqIEBpbnRlcm5hbCAqL1xyXG5jb25zdCBfdGV4dEZvbnRzOiBzdHJpbmdbXSA9IFtcclxuICAnRGVqYVZ1U2Fuc01vbm8tQm9sZC50dGYnLFxyXG4gICdEZWphVnVTYW5zTW9uby1Cb2xkT2JsaXF1ZS50dGYnLFxyXG4gICdEZWphVnVTYW5zTW9uby1PYmxpcXVlLnR0ZicsXHJcbiAgJ0RlamFWdVNhbnNNb25vLnR0ZicsXHJcbiAgJ0xpYmVydGludXNTZXJpZi1Cb2xkLm90ZicsXHJcbiAgJ0xpYmVydGludXNTZXJpZi1Cb2xkSXRhbGljLm90ZicsXHJcbiAgJ0xpYmVydGludXNTZXJpZi1JdGFsaWMub3RmJyxcclxuICAnTGliZXJ0aW51c1NlcmlmLVJlZ3VsYXIub3RmJyxcclxuICAnTGliZXJ0aW51c1NlcmlmLVNlbWlib2xkLm90ZicsXHJcbiAgJ0xpYmVydGludXNTZXJpZi1TZW1pYm9sZEl0YWxpYy5vdGYnLFxyXG4gICdOZXdDTTEwLUJvbGQub3RmJyxcclxuICAnTmV3Q00xMC1Cb2xkSXRhbGljLm90ZicsXHJcbiAgJ05ld0NNMTAtSXRhbGljLm90ZicsXHJcbiAgJ05ld0NNMTAtUmVndWxhci5vdGYnLFxyXG4gICdOZXdDTU1hdGgtQm9sZC5vdGYnLFxyXG4gICdOZXdDTU1hdGgtQm9vay5vdGYnLFxyXG4gICdOZXdDTU1hdGgtUmVndWxhci5vdGYnLFxyXG5dO1xyXG4vKiogQGludGVybmFsICovXHJcbmNvbnN0IF9jamtGb250czogc3RyaW5nW10gPSBbXHJcbiAgJ0lucmlhU2VyaWYtQm9sZC50dGYnLFxyXG4gICdJbnJpYVNlcmlmLUJvbGRJdGFsaWMudHRmJyxcclxuICAnSW5yaWFTZXJpZi1JdGFsaWMudHRmJyxcclxuICAnSW5yaWFTZXJpZi1SZWd1bGFyLnR0ZicsXHJcbiAgJ1JvYm90by1SZWd1bGFyLnR0ZicsXHJcbiAgJ05vdG9TZXJpZkNKS3NjLVJlZ3VsYXIub3RmJyxcclxuXTtcclxuLyoqIEBpbnRlcm5hbCAqL1xyXG5jb25zdCBfZW1vamlGb250czogc3RyaW5nW10gPSBbJ1R3aXR0ZXJDb2xvckVtb2ppLnR0ZicsICdOb3RvQ29sb3JFbW9qaS1SZWd1bGFyLUNPTFIuc3Vic2V0LnR0ZiddO1xyXG5cclxudHlwZSBBdmFpbGFibGVGb250QXNzZXQgPSAndGV4dCcgfCAnY2prJyB8ICdlbW9qaSc7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIExvYWRSZW1vdGVBc3NldHNPcHRpb25zIHtcclxuICAvKipcclxuICAgKiBwcmVsb2FkIGZvbnQgYXNzZXRzIG9yIGRvbid0IHByZWxvYWQgYW55IGZvbnQgYXNzZXRzXHJcbiAgICogQGRlZmF1bHQgWyd0ZXh0J11cclxuICAgKi9cclxuICBhc3NldHM/OiBBdmFpbGFibGVGb250QXNzZXRbXSB8IGZhbHNlO1xyXG5cclxuICAvKipcclxuICAgKiBjdXN0b21pemUgdXJsIHByZWZpeCBmb3IgZGVmYXVsdCBhc3NldHMgZnJvbSByZW1vdGVcclxuICAgKlxyXG4gICAqIFRoZSBkZWZhdWx0IGFzc2V0cyBhcmUgaG9zdGVkIG9uIGdpdGh1YiwgeW91IGNhbiBkb3dubG9hZCB0aGVtIGFuZCBob3N0XHJcbiAgICogdGhlbSBvbiB5b3VyIG93biBzZXJ2ZXIsIHdoaWNoIGlzIG1vcmUgcHJhY3RpY2FsIGZvciBwcm9kdWN0aW9uLlxyXG4gICAqXHJcbiAgICogSG9zdGVkIGF0OiBodHRwczovL2dpdGh1Yi5jb20vTXlyaWFkLURyZWFtaW4vdHlwc3QvdHJlZS9hc3NldHMtZm9udHNcclxuICAgKiBMaXN0IG9mIGFzc2V0czpcclxuICAgKiBTZWUge0BsaW5rIF90ZXh0Rm9udHN9LCB7QGxpbmsgX2Nqa0ZvbnRzfSwgYW5kIHtAbGluayBfZW1vamlGb250c31cclxuICAgKlxyXG4gICAqIEBkZWZhdWx0ICdqc2RlbGl2ci11cmwgb2YgdHlwc3QtYXNzZXRzIGFuZCB0eXBzdC1kZXYtYXNzZXRzJ1xyXG4gICAqL1xyXG4gIGFzc2V0VXJsUHJlZml4Pzogc3RyaW5nIHwgUmVjb3JkPHN0cmluZywgc3RyaW5nPjtcclxuXHJcbiAgLyoqXHJcbiAgICogY3VzdG9tIGZldGNoZXJcclxuICAgKiBOb3RlOiB0aGUgZGVmYXVsdCBmZXRjaGVyIGZvciBub2RlLmpzIGRvZXMgbm90IGNhY2hlIGFueSBmb250c1xyXG4gICAqIEBkZWZhdWx0IGZldGNoXHJcbiAgICovXHJcbiAgZmV0Y2hlcj86IHR5cGVvZiBmZXRjaDtcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBMb2FkUmVtb3RlRm9udHNPcHRpb25zIGV4dGVuZHMgTG9hZFJlbW90ZUFzc2V0c09wdGlvbnMge31cclxuXHJcbi8qKlxyXG4gKiBkaXNhYmxlIGRlZmF1bHQgZm9udCBhc3NldHNcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBkaXNhYmxlRGVmYXVsdEZvbnRBc3NldHMoKTogQmVmb3JlQnVpbGRGbiB7XHJcbiAgcmV0dXJuIHByZWxvYWRSZW1vdGVGb250cyhbXSwgeyBhc3NldHM6IGZhbHNlIH0pO1xyXG59XHJcblxyXG4vKipcclxuICogcHJlbG9hZCBmb250IGFzc2V0c1xyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHByZWxvYWRGb250QXNzZXRzKG9wdGlvbnM/OiBMb2FkUmVtb3RlQXNzZXRzT3B0aW9ucyk6IEJlZm9yZUJ1aWxkRm4ge1xyXG4gIHJldHVybiBwcmVsb2FkUmVtb3RlRm9udHMoW10sIG9wdGlvbnMpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX3Jlc29sdmVBc3NldHMob3B0aW9ucz86IExvYWRSZW1vdGVGb250c09wdGlvbnMpIHtcclxuICBjb25zdCBmb250cyA9IFtdO1xyXG4gIGlmIChcclxuICAgIG9wdGlvbnMgJiZcclxuICAgIG9wdGlvbnM/LmFzc2V0cyAhPT0gZmFsc2UgJiZcclxuICAgIG9wdGlvbnM/LmFzc2V0cz8ubGVuZ3RoICYmXHJcbiAgICBvcHRpb25zPy5hc3NldHM/Lmxlbmd0aCA+IDBcclxuICApIHtcclxuICAgIGxldCBkZWZhdWx0UHJlZml4OiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge1xyXG4gICAgICB0ZXh0OiAnaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L2doL3R5cHN0L3R5cHN0LWFzc2V0c0B2MC4xMy4xL2ZpbGVzL2ZvbnRzLycsXHJcbiAgICAgIF86ICdodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvZ2gvdHlwc3QvdHlwc3QtZGV2LWFzc2V0c0B2MC4xMy4xL2ZpbGVzL2ZvbnRzLycsXHJcbiAgICB9O1xyXG4gICAgbGV0IGFzc2V0VXJsUHJlZml4ID0gb3B0aW9ucy5hc3NldFVybFByZWZpeCA/PyBkZWZhdWx0UHJlZml4O1xyXG4gICAgaWYgKHR5cGVvZiBhc3NldFVybFByZWZpeCA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgYXNzZXRVcmxQcmVmaXggPSB7IF86IGFzc2V0VXJsUHJlZml4IH07XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBhc3NldFVybFByZWZpeCA9IHsgLi4uZGVmYXVsdFByZWZpeCwgLi4uYXNzZXRVcmxQcmVmaXggfTtcclxuICAgIH1cclxuICAgIGZvciAoY29uc3Qga2V5IG9mIE9iamVjdC5rZXlzKGFzc2V0VXJsUHJlZml4KSkge1xyXG4gICAgICBjb25zdCB1ID0gYXNzZXRVcmxQcmVmaXhba2V5XTtcclxuICAgICAgaWYgKHVbdS5sZW5ndGggLSAxXSAhPT0gJy8nKSB7XHJcbiAgICAgICAgYXNzZXRVcmxQcmVmaXhba2V5XSA9IHUgKyAnLyc7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBwcmVmaXggPSAoYXNzZXQ6IHN0cmluZywgZjogc3RyaW5nW10pID0+XHJcbiAgICAgIGYubWFwKGZvbnQgPT4gKGFzc2V0VXJsUHJlZml4W2Fzc2V0XSB8fCBhc3NldFVybFByZWZpeFsnXyddKSArIGZvbnQpO1xyXG4gICAgZm9yIChjb25zdCBhc3NldCBvZiBvcHRpb25zLmFzc2V0cykge1xyXG4gICAgICBzd2l0Y2ggKGFzc2V0KSB7XHJcbiAgICAgICAgY2FzZSAndGV4dCc6XHJcbiAgICAgICAgICBmb250cy5wdXNoKC4uLnByZWZpeChhc3NldCwgX3RleHRGb250cykpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnY2prJzpcclxuICAgICAgICAgIGZvbnRzLnB1c2goLi4ucHJlZml4KGFzc2V0LCBfY2prRm9udHMpKTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ2Vtb2ppJzpcclxuICAgICAgICAgIGZvbnRzLnB1c2goLi4ucHJlZml4KGFzc2V0LCBfZW1vamlGb250cykpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJldHVybiBmb250cztcclxufVxyXG5cclxuLyoqXHJcbiAqIHByZWxvYWQgcmVtb3RlIGZvbnRzXHJcbiAqXHJcbiAqIEBwYXJhbSBmb250cyAtIHVybCBwYXRoIHRvIGZvbnQgZmlsZXNcclxuICogQHJldHVybnMge0JlZm9yZUJ1aWxkRm59XHJcbiAqIEBleGFtcGxlXHJcbiAqIGBgYHR5cGVzY3JpcHRcclxuICogaW1wb3J0IHsgaW5pdCwgcHJlbG9hZFJlbW90ZUZvbnRzIH0gZnJvbSAndHlwc3QnO1xyXG4gKiBpbml0KHtcclxuICogICBiZWZvcmVCdWlsZDogW1xyXG4gKiAgICAgcHJlbG9hZFJlbW90ZUZvbnRzKFtcclxuICogICAgICAnaHR0cHM6Ly9mb250cy5nc3RhdGljLmNvbS9zL3JvYm90by92MjcvS0ZPbUNucUV1OTJGcjFNdTRteEtLVFUxS2cud29mZjInLCAvLyByZW1vdGUgdXJsXHJcbiAqICAgICAgJ2Rpc3QvZm9udHMvUm9ib3RvLVJlZ3VsYXIudHRmJywgLy8gcmVsYXRpdmUgdG8gdGhlIHJvb3Qgb2YgdGhlIHdlYnNpdGVcclxuICogICAgIF0pLFxyXG4gKiAgIF0sXHJcbiAqIH0pO1xyXG4gKiBgYGBcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBwcmVsb2FkUmVtb3RlRm9udHMoXHJcbiAgdXNlckZvbnRzOiAoc3RyaW5nIHwgVWludDhBcnJheSlbXSxcclxuICBvcHRpb25zPzogTG9hZFJlbW90ZUZvbnRzT3B0aW9ucyxcclxuKTogQmVmb3JlQnVpbGRGbiB7XHJcbiAgY29uc3QgYXNzZXRGb250cyA9IF9yZXNvbHZlQXNzZXRzKG9wdGlvbnMpO1xyXG4gIGNvbnN0IGxvYWRlciA9IGFzeW5jIChfOiBCZWZvcmVCdWlsZE1hcmssIHsgcmVmLCBidWlsZGVyIH06IEluaXRDb250ZXh0KSA9PiB7XHJcbiAgICBpZiAob3B0aW9ucz8uZmV0Y2hlcikge1xyXG4gICAgICByZWYuc2V0RmV0Y2hlcihvcHRpb25zLmZldGNoZXIpO1xyXG4gICAgfVxyXG4gICAgYXdhaXQgcmVmLmxvYWRGb250cyhidWlsZGVyLCBbLi4udXNlckZvbnRzLCAuLi5hc3NldEZvbnRzXSk7XHJcbiAgfTtcclxuICBsb2FkZXIuX3ByZWxvYWRSZW1vdGVGb250T3B0aW9ucyA9IG9wdGlvbnM7XHJcbiAgbG9hZGVyLl9raW5kID0gJ2ZvbnRMb2FkZXInO1xyXG4gIHJldHVybiBsb2FkZXI7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBwcmVsb2FkIHN5c3RlbSBmb250c1xyXG4gKiBAcGFyYW0gYnlGYW1pbHkgLSBmaWx0ZXIgc3lzdGVtIGZvbnRzIHRvIHByZWxvYWQgYnkgZmFtaWx5IG5hbWVcclxuICogQHJldHVybnMge0JlZm9yZUJ1aWxkRm59XHJcbiAqIEBleGFtcGxlXHJcbiAqIGBgYHR5cGVzY3JpcHRcclxuICogaW1wb3J0IHsgaW5pdCwgcHJlbG9hZFN5c3RlbUZvbnRzIH0gZnJvbSAndHlwc3QnO1xyXG4gKiBpbml0KHtcclxuICogICBiZWZvcmVCdWlsZDogW1xyXG4gKiAgICAgcHJlbG9hZFN5c3RlbUZvbnRzKHtcclxuICogICAgICAgYnlGYW1pbHk6IFsnUm9ib3RvJ10sIC8vIHByZWxvYWQgZm9udHMgYnkgZmFtaWx5IG5hbWVcclxuICogICAgIH0pLFxyXG4gKiAgIF0sXHJcbiAqIH0pO1xyXG4gKiBgYGBcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBwcmVsb2FkU3lzdGVtRm9udHMoeyBieUZhbWlseSB9OiB7IGJ5RmFtaWx5Pzogc3RyaW5nW10gfSk6IEJlZm9yZUJ1aWxkRm4ge1xyXG4gIHJldHVybiBhc3luYyAoXywgeyBidWlsZGVyIH06IEluaXRDb250ZXh0KSA9PiB7XHJcbiAgICBjb25zdCB0ID0gcGVyZm9ybWFuY2Uubm93KCk7XHJcblxyXG4gICAgaWYgKCdxdWVyeUxvY2FsRm9udHMnIGluIHdpbmRvdykge1xyXG4gICAgICBjb25zdCBmb250czoge1xyXG4gICAgICAgIGZhbWlseTogc3RyaW5nO1xyXG4gICAgICAgIGJsb2IoKTogUHJvbWlzZTxCbG9iPjtcclxuICAgICAgfVtdID0gYXdhaXQgKHdpbmRvdyBhcyBhbnkpLnF1ZXJ5TG9jYWxGb250cygpO1xyXG5cclxuICAgICAgYnlGYW1pbHkgPSBieUZhbWlseSA/PyBbXTtcclxuXHJcbiAgICAgIGZvciAoY29uc3QgZm9udCBvZiBmb250cykge1xyXG4gICAgICAgIGlmICghYnlGYW1pbHkuaW5jbHVkZXMoZm9udC5mYW1pbHkpKSB7XHJcbiAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGRhdGE6IEFycmF5QnVmZmVyID0gYXdhaXQgKGF3YWl0IGZvbnQuYmxvYigpKS5hcnJheUJ1ZmZlcigpO1xyXG4gICAgICAgIGF3YWl0IGJ1aWxkZXIuYWRkX3Jhd19mb250KG5ldyBVaW50OEFycmF5KGRhdGEpKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHQyID0gcGVyZm9ybWFuY2Uubm93KCk7XHJcbiAgICBjb25zb2xlLmxvZygncHJlbG9hZCBzeXN0ZW0gZm9udCB0aW1lIHVzZWQ6JywgdDIgLSB0KTtcclxuICB9O1xyXG59XHJcblxyXG4vKipcclxuICogKGNvbXBpbGUgb25seSkgc2V0IHBhY29hZ2UgcmVnaXN0cnlcclxuICpcclxuICogQHBhcmFtIGFjY2Vzc01vZGVsOiB3aGVuIGNvbXBpbGluZywgdGhlIHBhY29hZ2UgcmVnaXN0cnkgaXMgdXNlZCB0byBhY2Nlc3MgdGhlXHJcbiAqIGRhdGEgb2YgZmlsZXNcclxuICogQHJldHVybnMge0JlZm9yZUJ1aWxkRm59XHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gd2l0aFBhY2thZ2VSZWdpc3RyeShwYWNrYWdlUmVnaXN0cnk6IFBhY2thZ2VSZWdpc3RyeSk6IEJlZm9yZUJ1aWxkRm4ge1xyXG4gIHJldHVybiBhc3luYyAoXywgeyBidWlsZGVyIH06IEluaXRDb250ZXh0KSA9PiB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XHJcbiAgICAgIGJ1aWxkZXIuc2V0X3BhY2thZ2VfcmVnaXN0cnkocGFja2FnZVJlZ2lzdHJ5LCBmdW5jdGlvbiAoc3BlYzogUGFja2FnZVNwZWMpIHtcclxuICAgICAgICByZXR1cm4gcGFja2FnZVJlZ2lzdHJ5LnJlc29sdmUoc3BlYywgdGhpcyk7XHJcbiAgICAgIH0pO1xyXG4gICAgICByZXNvbHZlKCk7XHJcbiAgICB9KTtcclxuICB9O1xyXG59XHJcblxyXG4vKipcclxuICogKGNvbXBpbGUgb25seSkgc2V0IGFjY2VzcyBtb2RlbFxyXG4gKlxyXG4gKiBAcGFyYW0gYWNjZXNzTW9kZWw6IHdoZW4gY29tcGlsaW5nLCB0aGUgYWNjZXNzIG1vZGVsIGlzIHVzZWQgdG8gYWNjZXNzIHRoZVxyXG4gKiBkYXRhIG9mIGZpbGVzXHJcbiAqIEByZXR1cm5zIHtCZWZvcmVCdWlsZEZufVxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHdpdGhBY2Nlc3NNb2RlbChhY2Nlc3NNb2RlbDogRnNBY2Nlc3NNb2RlbCk6IEJlZm9yZUJ1aWxkRm4ge1xyXG4gIHJldHVybiBhc3luYyAoXywgY3R4OiBJbml0Q29udGV4dCkgPT4ge1xyXG4gICAgaWYgKGN0eC5hbHJlYWR5U2V0QWNjZXNzTW9kZWwpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKFxyXG4gICAgICAgIGBhbHJlYWR5IHNldCBzb21lIGFzc2VzcyBtb2RlbCBiZWZvcmU6ICR7Y3R4LmFscmVhZHlTZXRBY2Nlc3NNb2RlbC5jb25zdHJ1Y3Rvcj8ubmFtZX0oJHtjdHguYWxyZWFkeVNldEFjY2Vzc01vZGVsfSlgLFxyXG4gICAgICApO1xyXG4gICAgfVxyXG4gICAgY3R4LmFscmVhZHlTZXRBY2Nlc3NNb2RlbCA9IGFjY2Vzc01vZGVsO1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xyXG4gICAgICBjdHguYnVpbGRlci5zZXRfYWNjZXNzX21vZGVsKFxyXG4gICAgICAgIGFjY2Vzc01vZGVsLFxyXG4gICAgICAgIChwYXRoOiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgIGNvbnN0IGxhc3RNb2RpZmllZCA9IGFjY2Vzc01vZGVsLmdldE1UaW1lKHBhdGgpO1xyXG4gICAgICAgICAgaWYgKGxhc3RNb2RpZmllZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbGFzdE1vZGlmaWVkLmdldFRpbWUoKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgKHBhdGg6IHN0cmluZykgPT4ge1xyXG4gICAgICAgICAgcmV0dXJuIGFjY2Vzc01vZGVsLmlzRmlsZShwYXRoKSB8fCBmYWxzZTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIChwYXRoOiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgIHJldHVybiBhY2Nlc3NNb2RlbC5nZXRSZWFsUGF0aChwYXRoKSB8fCBwYXRoO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgKHBhdGg6IHN0cmluZykgPT4ge1xyXG4gICAgICAgICAgcmV0dXJuIGFjY2Vzc01vZGVsLnJlYWRBbGwocGF0aCk7XHJcbiAgICAgICAgfSxcclxuICAgICAgKTtcclxuICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgfSk7XHJcbiAgfTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEBpbnRlcm5hbCBidWlsZGVyXHJcbiAqL1xyXG50eXBlIEJ1aWxkZXIgPSB0eXBzdFJlbmRlcmVyLlR5cHN0UmVuZGVyZXJCdWlsZGVyICYgdHlwc3RDb21waWxlci5UeXBzdENvbXBpbGVyQnVpbGRlcjtcclxuXHJcbi8qKlxyXG4gKiBAaW50ZXJuYWwgYnVpbGQgY29udGV4dFxyXG4gKi9cclxuaW50ZXJmYWNlIEluaXRDb250ZXh0IHtcclxuICByZWY6IHtcclxuICAgIHNldEZldGNoZXIoZmV0Y2hlcjogdHlwZW9mIGZldGNoKTogdm9pZDtcclxuICAgIGxvYWRGb250cyhidWlsZGVyOiBCdWlsZGVyLCBmb250czogKHN0cmluZyB8IFVpbnQ4QXJyYXkpW10pOiBQcm9taXNlPHZvaWQ+O1xyXG4gIH07XHJcbiAgYnVpbGRlcjogQnVpbGRlcjtcclxuICBhbHJlYWR5U2V0QWNjZXNzTW9kZWw6IGFueTtcclxufVxyXG5cclxuLy8gdG9kbzogc2VhcmNoIGJyb3dzZXJcclxuLy8gc2VhcmNoZXIuc2VhcmNoX2Jyb3dzZXIoKS5hd2FpdD87XHJcbiJdfQ==