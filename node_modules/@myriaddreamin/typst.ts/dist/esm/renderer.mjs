import { TypstDefaultParams, kObject } from './internal.types.mjs';
import { RenderView } from './render/canvas/view.mjs';
import { LazyWasmModule } from './wasm.mjs';
import { buildComponent } from './init.mjs';
import { TypstDomDocument } from './dom.mjs';
/**
 * The session of a Typst document.
 * @property {string} backgroundColor - The background color of the Typst
 * document.
 * @property {number} pixelPerPt - The pixel per point scale up the image.
 *
 */
export class RenderSession {
    plugin;
    /**
     * @internal
     */
    [kObject];
    /**
     * @internal
     */
    constructor(
    /**
     * @internal
     */
    plugin, o) {
        this.plugin = plugin;
        this[kObject] = o;
    }
    /**
     * @deprecated set in {@link RenderToCanvasOptions} instead
     *
     * Set the background color of the Typst document.
     * @param {string} t - The background color in format of `^#?[0-9a-f]{6}$`
     *
     * Note: Default to `#ffffff`.
     *
     * Note: Only available in canvas rendering mode.
     */
    set backgroundColor(t) {
        if (t !== undefined) {
            this[kObject].background_color = t;
        }
    }
    /**
     * Get the background color of the Typst document.
     *
     * Note: Default to `#ffffff`.
     *
     * Note: Only available in canvas rendering mode.
     */
    get backgroundColor() {
        return this[kObject].background_color;
    }
    /**
     * Set the pixel per point scale up the canvas panel.
     *
     * Note: Default to `3`.
     *
     * Note: Only available in canvas rendering mode.
     */
    set pixelPerPt(t) {
        if (t !== undefined) {
            this[kObject].pixel_per_pt = t;
        }
    }
    /**
     * @deprecated set in {@link RenderToCanvasOptions} instead
     *
     * Get the pixel per point scale up the canvas panel.
     *
     * Note: Default to `3`.
     *
     * Note: Only available in canvas rendering mode.
     */
    get pixelPerPt() {
        return this[kObject].pixel_per_pt;
    }
    /**
     * Reset state
     */
    reset() {
        this.plugin.resetSession(this);
    }
    /**
     * @deprecated
     * use {@link docWidth} instead
     */
    get doc_width() {
        return this[kObject].doc_width;
    }
    get docWidth() {
        return this[kObject].doc_width;
    }
    /**
     * @deprecated
     * use {@link docHeight} instead
     */
    get doc_height() {
        return this[kObject].doc_height;
    }
    get docHeight() {
        return this[kObject].doc_height;
    }
    retrievePagesInfo() {
        const pages_info = this[kObject].pages_info;
        const pageInfos = [];
        const pageCount = pages_info.page_count;
        for (let i = 0; i < pageCount; i++) {
            const pageAst = pages_info.page(i);
            pageInfos.push({
                pageOffset: pageAst.page_off,
                width: pageAst.width_pt,
                height: pageAst.height_pt,
            });
        }
        return pageInfos;
    }
    getSourceLoc(path) {
        return this[kObject].source_span(path);
    }
    /**
     * See {@link TypstRenderer#renderSvg} for more details.
     */
    renderSvg(options) {
        return this.plugin.renderSvg({
            renderSession: this,
            ...options,
        });
    }
    /**
     * See {@link TypstRenderer#renderToSvg} for more details.
     */
    renderToSvg(options) {
        return this.plugin.renderToSvg({
            renderSession: this,
            ...options,
        });
    }
    /**
     * See {@link TypstRenderer#renderCanvas} for more details.
     */
    renderCanvas(options) {
        return this.plugin.renderCanvas({
            renderSession: this,
            ...options,
        });
    }
    /**
     * See {@link TypstRenderer#manipulateData} for more details.
     */
    manipulateData(opts) {
        this.plugin.manipulateData({
            renderSession: this,
            ...opts,
        });
    }
    /**
     * See {@link TypstRenderer#renderSvgDiff} for more details.
     */
    renderSvgDiff(opts) {
        return this.plugin.renderSvgDiff({
            renderSession: this,
            ...opts,
        });
    }
    /**
     * @deprecated
     * use {@link getSourceLoc} instead
     */
    get_source_loc(path) {
        return this[kObject].source_span(path);
    }
    /**
     * @deprecated
     * use {@link renderSvgDiff} instead
     */
    render_in_window(rect_lo_x, rect_lo_y, rect_hi_x, rect_hi_y) {
        return this[kObject].render_in_window(rect_lo_x, rect_lo_y, rect_hi_x, rect_hi_y);
    }
    /**
     * @deprecated
     * use {@link manipulateData} instead
     */
    merge_delta(data) {
        this.plugin.manipulateData({
            renderSession: this,
            action: 'merge',
            data,
        });
    }
}
/**
 * @internal
 */
var ManageStatus;
(function (ManageStatus) {
    ManageStatus[ManageStatus["Delete"] = 0] = "Delete";
    ManageStatus[ManageStatus["New"] = 1] = "New";
    ManageStatus[ManageStatus["Update"] = 2] = "Update";
})(ManageStatus || (ManageStatus = {}));
export class TypstWorker {
    plugin;
    /**
     * @internal
     */
    [kObject];
    /**
     * @internal
     */
    constructor(
    /**
     * @internal
     */
    plugin, o) {
        this.plugin = plugin;
        this[kObject] = o;
    }
    /**
     * See {@link TypstRenderer#manipulateData} for more details.
     */
    manipulateData(action, data) {
        return this[kObject].manipulate_data(action, data);
    }
    /**
     * @internal
     */
    managedCanvasElemList = new Map();
    /**
     * @internal
     */
    canvasCounter = Math.random();
    /**
     * You must submit all canvas in pages to ensure synchronization with the background worker
     *
     * See {@link TypstRenderer#renderCanvas} for more details.
     */
    renderCanvas(canvasElemList) {
        const m = this.managedCanvasElemList;
        for (const [_, elem] of m) {
            elem[0] = ManageStatus.Delete;
        }
        for (const elem of canvasElemList) {
            const canvas = elem.canvas;
            let elemId = canvas.dataset.manageId;
            let action = ManageStatus.Update;
            if (!elemId) {
                elemId = this.canvasCounter.toFixed(5);
                this.canvasCounter += 1;
                canvas.dataset.manageId = elemId;
                action = ManageStatus.New;
            }
            let prev = m.get(elemId);
            if (prev && prev[0] !== ManageStatus.Delete) {
                throw new Error('cannot update a canvas for two times in batch');
            }
            m.set(elemId, [action, { ...elem }]);
        }
        const entries = Array.from(m.entries());
        const actions = new Uint8Array(entries.length);
        const elements = new Array(entries.length);
        const options = entries.map(([key, [action, elem]], index) => {
            if (!action) {
                m.delete(key);
            }
            actions[index] = action;
            elements[index] = elem.canvas;
            return this.plugin.canvasOptionsToRust(elem);
        });
        return this[kObject].render_canvas(actions, elements, options);
    }
    async retrievePagesInfo() {
        const pages_info = await this[kObject].get_pages_info();
        console.log(pages_info);
        const pageInfos = [];
        const pageCount = pages_info.page_count;
        for (let i = 0; i < pageCount; i++) {
            const pageAst = pages_info.page(i);
            pageInfos.push({
                pageOffset: pageAst.page_off,
                width: pageAst.width_pt,
                height: pageAst.height_pt,
            });
        }
        return pageInfos;
    }
}
const gRendererModule = (module) => new LazyWasmModule(async (bin) => {
    return await module.default(bin);
});
/**
 * create a Typst renderer.
 * @returns {TypstRenderer} - The Typst renderer.
 * @example
 * ```typescript
 * import { createTypstRenderer } from 'typst';
 * const renderer = createTypstRenderer();
 * await renderer.init();
 * await renderer.render({
 *   container: document.getElementById('container'),
 *   artifactContent: '{ ... }',
 * });
 * ```
 */
export function createTypstRenderer() {
    return new TypstRendererDriver();
}
/**
 * @deprecated
 * use {@link createTypstRenderer} instead
 */
export function createTypstSvgRenderer() {
    return new TypstRendererDriver();
}
export async function rendererBuildInfo() {
    const renderModule = await import('@myriaddreamin/typst-ts-renderer');
    return renderModule.renderer_build_info();
}
let warnOnceCanvasSet = true;
/** @internal */
export class TypstRendererDriver {
    renderer;
    rendererJs;
    constructor() { }
    async init(options) {
        this.rendererJs = await (options?.getWrapper?.() || import('@myriaddreamin/typst-ts-renderer'));
        const TypstRendererBuilder = this.rendererJs.TypstRendererBuilder;
        this.renderer = await buildComponent(options, gRendererModule(this.rendererJs), TypstRendererBuilder, {});
    }
    loadGlyphPack(_pack) {
        // this.renderer.load_glyph_pack(pack);
        return Promise.resolve();
    }
    createOptionsToRust(options) {
        const rustOptions = new this.rendererJs.CreateSessionOptions();
        if (options.format !== undefined) {
            rustOptions.format = options.format;
        }
        if (options.artifactContent !== undefined) {
            rustOptions.artifact_content = options.artifactContent;
        }
        return rustOptions;
    }
    canvasOptionsToRust(options) {
        const rustOptions = new this.rendererJs.RenderPageImageOptions();
        if (options.pageOffset === undefined) {
            throw new Error('pageOffset is required in reflexo v0.5.0');
        }
        else {
            rustOptions.page_off = options.pageOffset;
        }
        if (options.cacheKey !== undefined) {
            rustOptions.cache_key = options.cacheKey;
        }
        if (options.backgroundColor !== undefined) {
            rustOptions.background_color = options.backgroundColor;
        }
        if (options.pixelPerPt !== undefined) {
            rustOptions.pixel_per_pt = options.pixelPerPt;
        }
        if (options.dataSelection !== undefined) {
            let encoded = 0;
            if (options.dataSelection.body) {
                encoded |= 1 << 0;
            }
            else if (options.canvas && warnOnceCanvasSet) {
                warnOnceCanvasSet = false;
                console.warn('dataSelection.body is not set but providing canvas for body');
            }
            if (options.dataSelection.text || options.dataSelection.annotation) {
                console.error('dataSelection.text and dataSelection.annotation are deprecated');
            }
            if (options.dataSelection.semantics) {
                encoded |= 1 << 3;
            }
            rustOptions.data_selection = encoded;
        }
        return rustOptions;
    }
    retrievePagesInfoFromSession(session) {
        return session.retrievePagesInfo();
    }
    /**
     * Render a Typst document to canvas.
     */
    renderCanvas(options) {
        return this.withinOptionSession(options, async (sessionRef) => {
            return this.renderer.render_page_to_canvas(sessionRef[kObject], options.canvas || undefined, this.canvasOptionsToRust(options));
        });
    }
    // async renderPdf(artifactContent: string): Promise<Uint8Array> {
    // return this.renderer.render_to_pdf(artifactContent);
    // }
    async inAnimationFrame(fn) {
        return new Promise((resolve, reject) => {
            requestAnimationFrame(() => {
                try {
                    resolve(fn());
                }
                catch (e) {
                    reject(e);
                }
            });
        });
    }
    async renderDisplayLayer(session, canvasList, options) {
        const pages_info = session[kObject].pages_info;
        const page_count = pages_info.page_count;
        const doRender = async (i, page_off) => {
            const canvas = canvasList[i];
            const ctx = canvas.getContext('2d');
            if (!ctx) {
                throw new Error('canvas context is null');
            }
            return await this.renderCanvas({
                ...options,
                canvas: ctx,
                renderSession: session,
                pageOffset: page_off,
            });
        };
        const t = performance.now();
        const textContentList = await (async () => {
            const results = [];
            for (let i = 0; i < page_count; i++) {
                results.push(await this.inAnimationFrame(() => doRender(i, i)));
            }
            return results;
        })();
        const t2 = performance.now();
        console.log(`display layer used: render = ${(t2 - t).toFixed(1)}ms`);
        return textContentList;
    }
    renderTextLayer(layerList, textSourceList) {
        const t2 = performance.now();
        layerList.forEach((layer, i) => {
            layer.innerHTML = textSourceList[i].htmlSemantics[0];
        });
        const t3 = performance.now();
        console.log(`text layer used: render = ${(t3 - t2).toFixed(1)}ms`);
    }
    async render(options) {
        if ('format' in options) {
            if (options.format !== 'vector') {
                const artifactFormats = ['serde_json', 'js', 'ir'];
                if (artifactFormats.includes(options.format)) {
                    // deprecated
                    throw new Error(`deprecated format ${options.format}, please use vector format`);
                }
            }
        }
        return this.renderToCanvas(options);
    }
    async renderDom(options) {
        if ('format' in options) {
            if (options.format !== 'vector') {
                const artifactFormats = ['serde_json', 'js', 'ir'];
                if (artifactFormats.includes(options.format)) {
                    // deprecated
                    throw new Error(`deprecated format ${options.format}, please use vector format`);
                }
            }
        }
        return this.withinOptionSession(options, async (sessionRef) => {
            const t = new TypstDomDocument({
                ...options,
                renderMode: 'dom',
                hookedElem: options.container,
                kModule: sessionRef,
                renderer: this,
            });
            t;
            await t.impl.mountDom(options.pixelPerPt);
            return t;
        });
    }
    async renderToCanvas(options) {
        let session;
        let renderPageResults;
        const mountContainer = options.container;
        mountContainer.style.visibility = 'hidden';
        const doRenderDisplayLayer = async (canvasList, resetLayout) => {
            try {
                renderPageResults = await this.renderDisplayLayer(session, canvasList, options);
                resetLayout();
            }
            finally {
                mountContainer.style.visibility = 'visible';
            }
        };
        return this.withinOptionSession(options, async (sessionRef) => {
            session = sessionRef;
            if (session[kObject].pages_info.page_count === 0) {
                throw new Error(`No page found in session`);
            }
            if (options.pixelPerPt !== undefined && options.pixelPerPt <= 0) {
                throw new Error('Invalid typst.RenderOptions.pixelPerPt, should be a positive number ' +
                    options.pixelPerPt);
            }
            let backgroundColor = options.backgroundColor;
            if (backgroundColor !== undefined) {
                if (!/^#[0-9a-f]{6}$/.test(backgroundColor)) {
                    throw new Error('Invalid typst.backgroundColor color for matching ^#?[0-9a-f]{6}$ ' + backgroundColor);
                }
            }
            session.pixelPerPt = options.pixelPerPt ?? TypstDefaultParams.PIXEL_PER_PT;
            session.backgroundColor = backgroundColor ?? '#ffffff';
            const t = performance.now();
            const pageView = new RenderView(this.retrievePagesInfoFromSession(session), mountContainer, options);
            const t2 = performance.now();
            console.log(`layer used: retrieve = ${(t2 - t).toFixed(1)}ms`);
            await doRenderDisplayLayer(pageView.canvasList, () => pageView.resetLayout());
            this.renderTextLayer(pageView.textLayerList, renderPageResults);
            return;
        });
    }
    createModule(b) {
        return Promise.resolve(new RenderSession(this, this.renderer.create_session(b &&
            this.createOptionsToRust({
                format: 'vector',
                artifactContent: b,
            }))));
    }
    async createWorkerV0(worker) {
        return new TypstWorker(this, await this.renderer.create_worker(worker));
    }
    workerBridge() {
        return this.renderer.create_worker_bridge();
    }
    renderSvg(options, container) {
        if (options instanceof RenderSession || container) {
            throw new Error('removed api, please use renderToSvg({ renderSession, container }) instead');
        }
        return this.withinOptionSession(options, async (sessionRef) => {
            let parts = undefined;
            if (options.data_selection) {
                parts = 0;
                if (options.data_selection.body) {
                    parts |= 1 << 0;
                }
                if (options.data_selection.defs) {
                    parts |= 1 << 1;
                }
                if (options.data_selection.css) {
                    parts |= 1 << 2;
                }
                if (options.data_selection.js) {
                    parts |= 1 << 3;
                }
            }
            return Promise.resolve(this.renderer.svg_data(sessionRef[kObject], parts));
        });
    }
    renderSvgDiff(options) {
        if (!options.window) {
            return this.renderer.render_svg_diff(options.renderSession[kObject], 0, 0, 1e33, 1e33);
        }
        return this.renderer.render_svg_diff(options.renderSession[kObject], options.window.lo.x, options.window.lo.y, options.window.hi.x, options.window.hi.y);
    }
    renderToSvg(options) {
        return this.withinOptionSession(options, async (sessionRef) => {
            return Promise.resolve(this.renderer.render_svg(sessionRef[kObject], options.container));
        });
    }
    getCustomV1(options) {
        return Promise.resolve(this.renderer.get_customs(options.renderSession[kObject]));
    }
    resetSession(session) {
        return this.renderer.reset(session[kObject]);
    }
    manipulateData(opts) {
        return this.renderer.manipulate_data(opts.renderSession[kObject], opts.action ?? 'reset', opts.data);
    }
    withinOptionSession(options, fn) {
        function isRenderByContentOption(options) {
            return 'artifactContent' in options;
        }
        if ('renderSession' in options) {
            return fn(options.renderSession);
        }
        if (isRenderByContentOption(options)) {
            // todo: remove any
            return this.runWithSession(options, fn);
        }
        throw new Error('Invalid render options, should be one of RenderByContentOptions|RenderBySessionOptions');
    }
    async runWithSession(arg1, arg2) {
        let options = arg1;
        let fn = arg2;
        if (!arg2) {
            options = undefined;
            fn = arg1;
        }
        const session = this.renderer.create_session(
        /* moved */ options && this.createOptionsToRust(options));
        try {
            const res = await fn(new RenderSession(this, session));
            session.free();
            return res;
        }
        catch (e) {
            session.free();
            throw e;
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVuZGVyZXIubWpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3JlbmRlcmVyLm10cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFJQSxPQUFPLEVBQWdDLGtCQUFrQixFQUFFLE9BQU8sRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBYWpHLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUN0RCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sWUFBWSxDQUFDO0FBQzVDLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFDNUMsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sV0FBVyxDQUFDO0FBZTdDOzs7Ozs7R0FNRztBQUNILE1BQU0sT0FBTyxhQUFhO0lBYWQ7SUFaVjs7T0FFRztJQUNJLENBQUMsT0FBTyxDQUFDLENBQXNCO0lBRXRDOztPQUVHO0lBQ0g7SUFDRTs7T0FFRztJQUNLLE1BQXFCLEVBQzdCLENBQXNCO1FBRGQsV0FBTSxHQUFOLE1BQU0sQ0FBZTtRQUc3QixJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ3BCLENBQUM7SUFFRDs7Ozs7Ozs7O09BU0c7SUFDSCxJQUFJLGVBQWUsQ0FBQyxDQUFxQjtRQUN2QyxJQUFJLENBQUMsS0FBSyxTQUFTLEVBQUUsQ0FBQztZQUNwQixJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsZ0JBQWdCLEdBQUcsQ0FBQyxDQUFDO1FBQ3JDLENBQUM7SUFDSCxDQUFDO0lBRUQ7Ozs7OztPQU1HO0lBQ0gsSUFBSSxlQUFlO1FBQ2pCLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLGdCQUFnQixDQUFDO0lBQ3hDLENBQUM7SUFFRDs7Ozs7O09BTUc7SUFDSCxJQUFJLFVBQVUsQ0FBQyxDQUFxQjtRQUNsQyxJQUFJLENBQUMsS0FBSyxTQUFTLEVBQUUsQ0FBQztZQUNwQixJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsWUFBWSxHQUFH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LEVBQUUsQ0FBQztZQUNmLE1BQU0sQ0FBQyxDQUFDO1FBQ1YsQ0FBQztJQUNILENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbIi8vIEB0cy1pZ25vcmVcclxuaW1wb3J0IHR5cGUgKiBhcyB0eXBzdCBmcm9tICdAbXlyaWFkZHJlYW1pbi90eXBzdC10cy1yZW5kZXJlcic7XHJcblxyXG5pbXBvcnQgdHlwZSB7IEluaXRPcHRpb25zIH0gZnJvbSAnLi9vcHRpb25zLmluaXQubWpzJztcclxuaW1wb3J0IHsgUGFnZUluZm8sIFJlbmRlckNhbnZhc1Jlc3VsdCwgVHlwc3REZWZhdWx0UGFyYW1zLCBrT2JqZWN0IH0gZnJvbSAnLi9pbnRlcm5hbC50eXBlcy5tanMnO1xyXG5pbXBvcnQge1xyXG4gIENyZWF0ZVNlc3Npb25PcHRpb25zLFxyXG4gIFJlbmRlclRvQ2FudmFzT3B0aW9ucyxcclxuICBSZW5kZXJPcHRpb25zLFxyXG4gIFJlbmRlckNhbnZhc09wdGlvbnMsXHJcbiAgUmVuZGVyVG9TdmdPcHRpb25zLFxyXG4gIE1hbmlwdWxhdGVEYXRhT3B0aW9ucyxcclxuICBSZW5kZXJTdmdPcHRpb25zLFxyXG4gIFJlbmRlckluU2Vzc2lvbk9wdGlvbnMsXHJcbiAgTW91bnREb21PcHRpb25zLFxyXG4gIE9mZnNjcmVlblJlbmRlckNhbnZhc09wdGlvbnMsXHJcbn0gZnJvbSAnLi9vcHRpb25zLnJlbmRlci5tanMnO1xyXG5pbXBvcnQgeyBSZW5kZXJWaWV3IH0gZnJvbSAnLi9yZW5kZXIvY2FudmFzL3ZpZXcubWpzJztcclxuaW1wb3J0IHsgTGF6eVdhc21Nb2R1bGUgfSBmcm9tICcuL3dhc20ubWpzJztcclxuaW1wb3J0IHsgYnVpbGRDb21wb25lbnQgfSBmcm9tICcuL2luaXQubWpzJztcclxuaW1wb3J0IHsgVHlwc3REb21Eb2N1bWVudCB9IGZyb20gJy4vZG9tLm1qcyc7XHJcblxyXG4vKipcclxuICogVGhlIHJlc3VsdCBvZiByZW5kZXJpbmcgYSBUeXBzdCBkb2N1bWVudC5cclxuICogQHR5cGVkZWYge09iamVjdH0gUmVuZGVyUmVzdWx0XHJcbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSB3aWR0aCAtIFRoZSB3aWR0aCBvZiB0aGUgcmVuZGVyZWQgVHlwc3QgZG9jdW1lbnQgKHNpbmdsZSBwYWdlKS5cclxuICogQHByb3BlcnR5IHtudW1iZXJ9IGhlaWdodCAtIFRoZSBoZWlnaHQgb2YgdGhlIHJlbmRlcmVkIFR5cHN0IGRvY3VtZW50IChzaW5nbGUgcGFnZSkuXHJcbiAqL1xyXG5leHBvcnQgaW50ZXJmYWNlIFJlbmRlclJlc3VsdCB7XHJcbiAgd2lkdGg6IG51bWJlcjtcclxuICBoZWlnaHQ6IG51bWJlcjtcclxufVxyXG5cclxudHlwZSBDb250ZXh0ZWRSZW5kZXJPcHRpb25zPFQ+ID0gVCB8IFJlbmRlck9wdGlvbnM8VD47XHJcblxyXG4vKipcclxuICogVGhlIHNlc3Npb24gb2YgYSBUeXBzdCBkb2N1bWVudC5cclxuICogQHByb3BlcnR5IHtzdHJpbmd9IGJhY2tncm91bmRDb2xvciAtIFRoZSBiYWNrZ3JvdW5kIGNvbG9yIG9mIHRoZSBUeXBzdFxyXG4gKiBkb2N1bWVudC5cclxuICogQHByb3BlcnR5IHtudW1iZXJ9IHBpeGVsUGVyUHQgLSBUaGUgcGl4ZWwgcGVyIHBvaW50IHNjYWxlIHVwIHRoZSBpbWFnZS5cclxuICpcclxuICovXHJcbmV4cG9ydCBjbGFzcyBSZW5kZXJTZXNzaW9uIHtcclxuICAvKipcclxuICAgKiBAaW50ZXJuYWxcclxuICAgKi9cclxuICBwdWJsaWMgW2tPYmplY3RdOiB0eXBzdC5SZW5kZXJTZXNzaW9uO1xyXG5cclxuICAvKipcclxuICAgKiBAaW50ZXJuYWxcclxuICAgKi9cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIC8qKlxyXG4gICAgICogQGludGVybmFsXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgcGx1Z2luOiBUeXBzdFJlbmRlcmVyLFxyXG4gICAgbzogdHlwc3QuUmVuZGVyU2Vzc2lvbixcclxuICApIHtcclxuICAgIHRoaXNba09iamVjdF0gPSBvO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQGRlcHJlY2F0ZWQgc2V0IGluIHtAbGluayBSZW5kZXJUb0NhbnZhc09wdGlvbnN9IGluc3RlYWRcclxuICAgKlxyXG4gICAqIFNldCB0aGUgYmFja2dyb3VuZCBjb2xvciBvZiB0aGUgVHlwc3QgZG9jdW1lbnQuXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IHQgLSBUaGUgYmFja2dyb3VuZCBjb2xvciBpbiBmb3JtYXQgb2YgYF4jP1swLTlhLWZdezZ9JGBcclxuICAgKlxyXG4gICAqIE5vdGU6IERlZmF1bHQgdG8gYCNmZmZmZmZgLlxyXG4gICAqXHJcbiAgICogTm90ZTogT25seSBhdmFpbGFibGUgaW4gY2FudmFzIHJlbmRlcmluZyBtb2RlLlxyXG4gICAqL1xyXG4gIHNldCBiYWNrZ3JvdW5kQ29sb3IodDogc3RyaW5nIHwgdW5kZWZpbmVkKSB7XHJcbiAgICBpZiAodCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIHRoaXNba09iamVjdF0uYmFja2dyb3VuZF9jb2xvciA9IHQ7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgdGhlIGJhY2tncm91bmQgY29sb3Igb2YgdGhlIFR5cHN0IGRvY3VtZW50LlxyXG4gICAqXHJcbiAgICogTm90ZTogRGVmYXVsdCB0byBgI2ZmZmZmZmAuXHJcbiAgICpcclxuICAgKiBOb3RlOiBPbmx5IGF2YWlsYWJsZSBpbiBjYW52YXMgcmVuZGVyaW5nIG1vZGUuXHJcbiAgICovXHJcbiAgZ2V0IGJhY2tncm91bmRDb2xvcigpOiBzdHJpbmcgfCB1bmRlZmluZWQge1xyXG4gICAgcmV0dXJuIHRoaXNba09iamVjdF0uYmFja2dyb3VuZF9jb2xvcjtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNldCB0aGUgcGl4ZWwgcGVyIHBvaW50IHNjYWxlIHVwIHRoZSBjYW52YXMgcGFuZWwuXHJcbiAgICpcclxuICAgKiBOb3RlOiBEZWZhdWx0IHRvIGAzYC5cclxuICAgKlxyXG4gICAqIE5vdGU6IE9ubHkgYXZhaWxhYmxlIGluIGNhbnZhcyByZW5kZXJpbmcgbW9kZS5cclxuICAgKi9cclxuICBzZXQgcGl4ZWxQZXJQdCh0OiBudW1iZXIgfCB1bmRlZmluZWQpIHtcclxuICAgIGlmICh0ICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgdGhpc1trT2JqZWN0XS5waXhlbF9wZXJfcHQgPSB0O1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQGRlcHJlY2F0ZWQgc2V0IGluIHtAbGluayBSZW5kZXJUb0NhbnZhc09wdGlvbnN9IGluc3RlYWRcclxuICAgKlxyXG4gICAqIEdldCB0aGUgcGl4ZWwgcGVyIHBvaW50IHNjYWxlIHVwIHRoZSBjYW52YXMgcGFuZWwuXHJcbiAgICpcclxuICAgKiBOb3RlOiBEZWZhdWx0IHRvIGAzYC5cclxuICAgKlxyXG4gICAqIE5vdGU6IE9ubHkgYXZhaWxhYmxlIGluIGNhbnZhcyByZW5kZXJpbmcgbW9kZS5cclxuICAgKi9cclxuICBnZXQgcGl4ZWxQZXJQdCgpOiBudW1iZXIgfCB1bmRlZmluZWQge1xyXG4gICAgcmV0dXJuIHRoaXNba09iamVjdF0ucGl4ZWxfcGVyX3B0O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzZXQgc3RhdGVcclxuICAgKi9cclxuICByZXNldCgpOiB2b2lkIHtcclxuICAgIHRoaXMucGx1Z2luLnJlc2V0U2Vzc2lvbih0aGlzKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBkZXByZWNhdGVkXHJcbiAgICogdXNlIHtAbGluayBkb2NXaWR0aH0gaW5zdGVhZFxyXG4gICAqL1xyXG4gIGdldCBkb2Nfd2lkdGgoKTogbnVtYmVyIHtcclxuICAgIHJldHVybiB0aGlzW2tPYmplY3RdLmRvY193aWR0aDtcclxuICB9XHJcblxyXG4gIGdldCBkb2NXaWR0aCgpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIHRoaXNba09iamVjdF0uZG9jX3dpZHRoO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQGRlcHJlY2F0ZWRcclxuICAgKiB1c2Uge0BsaW5rIGRvY0hlaWdodH0gaW5zdGVhZFxyXG4gICAqL1xyXG4gIGdldCBkb2NfaGVpZ2h0KCk6IG51bWJlciB7XHJcbiAgICByZXR1cm4gdGhpc1trT2JqZWN0XS5kb2NfaGVpZ2h0O1xyXG4gIH1cclxuXHJcbiAgZ2V0IGRvY0hlaWdodCgpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIHRoaXNba09iamVjdF0uZG9jX2hlaWdodDtcclxuICB9XHJcblxyXG4gIHJldHJpZXZlUGFnZXNJbmZvKCk6IFBhZ2VJbmZvW10ge1xyXG4gICAgY29uc3QgcGFnZXNfaW5mbyA9IHRoaXNba09iamVjdF0ucGFnZXNfaW5mbztcclxuICAgIGNvbnN0IHBhZ2VJbmZvczogUGFnZUluZm9bXSA9IFtdO1xyXG4gICAgY29uc3QgcGFnZUNvdW50ID0gcGFnZXNfaW5mby5wYWdlX2NvdW50O1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwYWdlQ291bnQ7IGkrKykge1xyXG4gICAgICBjb25zdCBwYWdlQXN0ID0gcGFnZXNfaW5mby5wYWdlKGkpO1xyXG4gICAgICBwYWdlSW5mb3MucHVzaCh7XHJcbiAgICAgICAgcGFnZU9mZnNldDogcGFnZUFzdC5wYWdlX29mZixcclxuICAgICAgICB3aWR0aDogcGFnZUFzdC53aWR0aF9wdCxcclxuICAgICAgICBoZWlnaHQ6IHBhZ2VBc3QuaGVpZ2h0X3B0LFxyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gcGFnZUluZm9zO1xyXG4gIH1cclxuXHJcbiAgZ2V0U291cmNlTG9jKHBhdGg6IFVpbnQzMkFycmF5KTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcclxuICAgIHJldHVybiAodGhpc1trT2JqZWN0XSBhcyB0eXBzdC5SZW5kZXJTZXNzaW9uKS5zb3VyY2Vfc3BhbihwYXRoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNlZSB7QGxpbmsgVHlwc3RSZW5kZXJlciNyZW5kZXJTdmd9IGZvciBtb3JlIGRldGFpbHMuXHJcbiAgICovXHJcbiAgcmVuZGVyU3ZnKG9wdGlvbnM6IENvbnRleHRlZFJlbmRlck9wdGlvbnM8UmVuZGVyU3ZnT3B0aW9ucz4pOiBQcm9taXNlPHN0cmluZz4ge1xyXG4gICAgcmV0dXJuIHRoaXMucGx1Z2luLnJlbmRlclN2Zyh7XHJcbiAgICAgIHJlbmRlclNlc3Npb246IHRoaXMsXHJcbiAgICAgIC4uLm9wdGlvbnMsXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNlZSB7QGxpbmsgVHlwc3RSZW5kZXJlciNyZW5kZXJUb1N2Z30gZm9yIG1vcmUgZGV0YWlscy5cclxuICAgKi9cclxuICByZW5kZXJUb1N2ZyhvcHRpb25zOiBDb250ZXh0ZWRSZW5kZXJPcHRpb25zPFJlbmRlclRvU3ZnT3B0aW9ucz4pOiBQcm9taXNlPGJvb2xlYW4+IHtcclxuICAgIHJldHVybiB0aGlzLnBsdWdpbi5yZW5kZXJUb1N2Zyh7XHJcbiAgICAgIHJlbmRlclNlc3Npb246IHRoaXMsXHJcbiAgICAgIC4uLm9wdGlvbnMsXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNlZSB7QGxpbmsgVHlwc3RSZW5kZXJlciNyZW5kZXJDYW52YXN9IGZvciBtb3JlIGRldGFpbHMuXHJcbiAgICovXHJcbiAgcmVuZGVyQ2FudmFzKG9wdGlvbnM6IENvbnRleHRlZFJlbmRlck9wdGlvbnM8UmVuZGVyQ2FudmFzT3B0aW9ucz4pOiBQcm9taXNlPFJlbmRlckNhbnZhc1Jlc3VsdD4ge1xyXG4gICAgcmV0dXJuIHRoaXMucGx1Z2luLnJlbmRlckNhbnZhcyh7XHJcbiAgICAgIHJlbmRlclNlc3Npb246IHRoaXMsXHJcbiAgICAgIC4uLm9wdGlvbnMsXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFNlZSB7QGxpbmsgVHlwc3RSZW5kZXJlciNtYW5pcHVsYXRlRGF0YX0gZm9yIG1vcmUgZGV0YWlscy5cclxuICAgKi9cclxuICBtYW5pcHVsYXRlRGF0YShvcHRzOiBNYW5pcHVsYXRlRGF0YU9wdGlvbnMpIHtcclxuICAgIHRoaXMucGx1Z2luLm1hbmlwdWxhdGVEYXRhKHtcclxuICAgICAgcmVuZGVyU2Vzc2lvbjogdGhpcyxcclxuICAgICAgLi4ub3B0cyxcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2VlIHtAbGluayBUeXBzdFJlbmRlcmVyI3JlbmRlclN2Z0RpZmZ9IGZvciBtb3JlIGRldGFpbHMuXHJcbiAgICovXHJcbiAgcmVuZGVyU3ZnRGlmZihvcHRzOiBSZW5kZXJTdmdPcHRpb25zKTogc3RyaW5nIHtcclxuICAgIHJldHVybiB0aGlzLnBsdWdpbi5yZW5kZXJTdmdEaWZmKHtcclxuICAgICAgcmVuZGVyU2Vzc2lvbjogdGhpcyxcclxuICAgICAgLi4ub3B0cyxcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQGRlcHJlY2F0ZWRcclxuICAgKiB1c2Uge0BsaW5rIGdldFNvdXJjZUxvY30gaW5zdGVhZFxyXG4gICAqL1xyXG4gIGdldF9zb3VyY2VfbG9jKHBhdGg6IFVpbnQzMkFycmF5KTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcclxuICAgIHJldHVybiAodGhpc1trT2JqZWN0XSBhcyB0eXBzdC5SZW5kZXJTZXNzaW9uKS5zb3VyY2Vfc3BhbihwYXRoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBkZXByZWNhdGVkXHJcbiAgICogdXNlIHtAbGluayByZW5kZXJTdmdEaWZmfSBpbnN0ZWFkXHJcbiAgICovXHJcbiAgcmVuZGVyX2luX3dpbmRvdyhyZWN0X2xvX3g6IG51bWJlciwgcmVjdF9sb195OiBudW1iZXIsIHJlY3RfaGlfeDogbnVtYmVyLCByZWN0X2hpX3k6IG51bWJlcikge1xyXG4gICAgcmV0dXJuIHRoaXNba09iamVjdF0ucmVuZGVyX2luX3dpbmRvdyhyZWN0X2xvX3gsIHJlY3RfbG9feSwgcmVjdF9oaV94LCByZWN0X2hpX3kpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQGRlcHJlY2F0ZWRcclxuICAgKiB1c2Uge0BsaW5rIG1hbmlwdWxhdGVEYXRhfSBpbnN0ZWFkXHJcbiAgICovXHJcbiAgbWVyZ2VfZGVsdGEoZGF0YTogVWludDhBcnJheSkge1xyXG4gICAgdGhpcy5wbHVnaW4ubWFuaXB1bGF0ZURhdGEoe1xyXG4gICAgICByZW5kZXJTZXNzaW9uOiB0aGlzLFxyXG4gICAgICBhY3Rpb246ICdtZXJnZScsXHJcbiAgICAgIGRhdGEsXHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBAaW50ZXJuYWxcclxuICovXHJcbmNvbnN0IGVudW0gTWFuYWdlU3RhdHVzIHtcclxuICBEZWxldGUsXHJcbiAgTmV3LFxyXG4gIFVwZGF0ZSxcclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIFR5cHN0V29ya2VyIHtcclxuICAvKipcclxuICAgKiBAaW50ZXJuYWxcclxuICAgKi9cclxuICBwdWJsaWMgW2tPYmplY3RdOiB0eXBzdC5UeXBzdFdvcmtlcjtcclxuXHJcbiAgLyoqXHJcbiAgICogQGludGVybmFsXHJcbiAgICovXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICAvKipcclxuICAgICAqIEBpbnRlcm5hbFxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIHBsdWdpbjogVHlwc3RSZW5kZXJlckRyaXZlcixcclxuICAgIG86IHR5cHN0LlR5cHN0V29ya2VyLFxyXG4gICkge1xyXG4gICAgdGhpc1trT2JqZWN0XSA9IG87XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZWUge0BsaW5rIFR5cHN0UmVuZGVyZXIjbWFuaXB1bGF0ZURhdGF9IGZvciBtb3JlIGRldGFpbHMuXHJcbiAgICovXHJcbiAgbWFuaXB1bGF0ZURhdGEoYWN0aW9uOiBzdHJpbmcsIGRhdGE6IFVpbnQ4QXJyYXkpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIHJldHVybiB0aGlzW2tPYmplY3RdLm1hbmlwdWxhdGVfZGF0YShhY3Rpb24sIGRhdGEpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQGludGVybmFsXHJcbiAgICovXHJcbiAgbWFuYWdlZENhbnZhc0VsZW1MaXN0ID0gbmV3IE1hcDxzdHJpbmcsIFtNYW5hZ2VTdGF0dXMsIE9mZnNjcmVlblJlbmRlckNhbnZhc09wdGlvbnNdPigpO1xyXG4gIC8qKlxyXG4gICAqIEBpbnRlcm5hbFxyXG4gICAqL1xyXG4gIGNhbnZhc0NvdW50ZXIgPSBNYXRoLnJhbmRvbSgpO1xyXG4gIC8qKlxyXG4gICAqIFlvdSBtdXN0IHN1Ym1pdCBhbGwgY2FudmFzIGluIHBhZ2VzIHRvIGVuc3VyZSBzeW5jaHJvbml6YXRpb24gd2l0aCB0aGUgYmFja2dyb3VuZCB3b3JrZXJcclxuICAgKlxyXG4gICAqIFNlZSB7QGxpbmsgVHlwc3RSZW5kZXJlciNyZW5kZXJDYW52YXN9IGZvciBtb3JlIGRldGFpbHMuXHJcbiAgICovXHJcbiAgcmVuZGVyQ2FudmFzKGNhbnZhc0VsZW1MaXN0OiBPZmZzY3JlZW5SZW5kZXJDYW52YXNPcHRpb25zW10pOiBQcm9taXNlPFJlbmRlckNhbnZhc1Jlc3VsdFtdPiB7XHJcbiAgICBjb25zdCBtID0gdGhpcy5tYW5hZ2VkQ2FudmFzRWxlbUxpc3Q7XHJcbiAgICBmb3IgKGNvbnN0IFtfLCBlbGVtXSBvZiBtKSB7XHJcbiAgICAgIGVsZW1bMF0gPSBNYW5hZ2VTdGF0dXMuRGVsZXRlO1xyXG4gICAgfVxyXG5cclxuICAgIGZvciAoY29uc3QgZWxlbSBvZiBjYW52YXNFbGVtTGlzdCkge1xyXG4gICAgICBjb25zdCBjYW52YXMgPSBlbGVtLmNhbnZhcztcclxuICAgICAgbGV0IGVsZW1JZCA9IGNhbnZhcy5kYXRhc2V0Lm1hbmFnZUlkO1xyXG4gICAgICBsZXQgYWN0aW9uID0gTWFuYWdlU3RhdHVzLlVwZGF0ZTtcclxuICAgICAgaWYgKCFlbGVtSWQpIHtcclxuICAgICAgICBlbGVtSWQgPSB0aGlzLmNhbnZhc0NvdW50ZXIudG9GaXhlZCg1KTtcclxuICAgICAgICB0aGlzLmNhbnZhc0NvdW50ZXIgKz0gMTtcclxuICAgICAgICBjYW52YXMuZGF0YXNldC5tYW5hZ2VJZCA9IGVsZW1JZDtcclxuICAgICAgICBhY3Rpb24gPSBNYW5hZ2VTdGF0dXMuTmV3O1xyXG4gICAgICB9XHJcblxyXG4gICAgICBsZXQgcHJldiA9IG0uZ2V0KGVsZW1JZCk7XHJcbiAgICAgIGlmIChwcmV2ICYmIHByZXZbMF0gIT09IE1hbmFnZVN0YXR1cy5EZWxldGUpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2Nhbm5vdCB1cGRhdGUgYSBjYW52YXMgZm9yIHR3byB0aW1lcyBpbiBiYXRjaCcpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBtLnNldChlbGVtSWQsIFthY3Rpb24sIHsgLi4uZWxlbSB9XSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgZW50cmllcyA9IEFycmF5LmZyb20obS5lbnRyaWVzKCkpO1xyXG4gICAgY29uc3QgYWN0aW9ucyA9IG5ldyBVaW50OEFycmF5KGVudHJpZXMubGVuZ3RoKTtcclxuICAgIGNvbnN0IGVsZW1lbnRzID0gbmV3IEFycmF5KGVudHJpZXMubGVuZ3RoKTtcclxuICAgIGNvbnN0IG9wdGlvbnMgPSBlbnRyaWVzLm1hcCgoW2tleSwgW2FjdGlvbiwgZWxlbV1dLCBpbmRleCkgPT4ge1xyXG4gICAgICBpZiAoIWFjdGlvbikge1xyXG4gICAgICAgIG0uZGVsZXRlKGtleSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGFjdGlvbnNbaW5kZXhdID0gYWN0aW9uO1xyXG4gICAgICBlbGVtZW50c1tpbmRleF0gPSBlbGVtLmNhbnZhcztcclxuICAgICAgcmV0dXJuIHRoaXMucGx1Z2luLmNhbnZhc09wdGlvbnNUb1J1c3QoZWxlbSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gdGhpc1trT2JqZWN0XS5yZW5kZXJfY2FudmFzKGFjdGlvbnMsIGVsZW1lbnRzLCBvcHRpb25zKTtcclxuICB9XHJcblxyXG4gIGFzeW5jIHJldHJpZXZlUGFnZXNJbmZvKCk6IFByb21pc2U8UGFnZUluZm9bXT4ge1xyXG4gICAgY29uc3QgcGFnZXNfaW5mbyA9IGF3YWl0IHRoaXNba09iamVjdF0uZ2V0X3BhZ2VzX2luZm8oKTtcclxuICAgIGNvbnNvbGUubG9nKHBhZ2VzX2luZm8pO1xyXG4gICAgY29uc3QgcGFnZUluZm9zOiBQYWdlSW5mb1tdID0gW107XHJcbiAgICBjb25zdCBwYWdlQ291bnQgPSBwYWdlc19pbmZvLnBhZ2VfY291bnQ7XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHBhZ2VDb3VudDsgaSsrKSB7XHJcbiAgICAgIGNvbnN0IHBhZ2VBc3QgPSBwYWdlc19pbmZvLnBhZ2UoaSk7XHJcbiAgICAgIHBhZ2VJbmZvcy5wdXNoKHtcclxuICAgICAgICBwYWdlT2Zmc2V0OiBwYWdlQXN0LnBhZ2Vfb2ZmLFxyXG4gICAgICAgIHdpZHRoOiBwYWdlQXN0LndpZHRoX3B0LFxyXG4gICAgICAgIGhlaWdodDogcGFnZUFzdC5oZWlnaHRfcHQsXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBwYWdlSW5mb3M7XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogVGhlIGludGVyZmFjZSBvZiBUeXBzdCByZW5kZXJlci5cclxuICovXHJcbmV4cG9ydCBpbnRlcmZhY2UgVHlwc3RSZW5kZXJlciBleHRlbmRzIFR5cHN0U3ZnUmVuZGVyZXIge1xyXG4gIC8qKlxyXG4gICAqIEluaXRpYWxpemUgdGhlIHR5cHN0IHJlbmRlcmVyLlxyXG4gICAqIEBwYXJhbSB7UGFydGlhbDxJbml0T3B0aW9ucz59IG9wdGlvbnMgLSBUaGUgb3B0aW9ucyBmb3IgaW5pdGlhbGl6aW5nIHRoZVxyXG4gICAqIHR5cHN0IHJlbmRlcmVyLlxyXG4gICAqL1xyXG4gIGluaXQob3B0aW9ucz86IFBhcnRpYWw8SW5pdE9wdGlvbnM+KTogUHJvbWlzZTx2b2lkPjtcclxuXHJcbiAgLyoqXHJcbiAgICogTG9hZCBhIGdseXBoIHBhY2sgZm9yIGFsbCBvZiB0aGUgVHlwc3QgZG9jdW1lbnRzIHRvIHJlbmRlci5cclxuICAgKiBOb3RlOiB0aGlzIGZ1bmN0aW9uIGlzIHN0aWxsIHVuZGVyIGRldmVsb3BtZW50LlxyXG4gICAqIEBwYXJhbSBwYWNrXHJcbiAgICovXHJcbiAgbG9hZEdseXBoUGFjayhwYWNrOiB1bmtub3duKTogUHJvbWlzZTx2b2lkPjtcclxuXHJcbiAgLyoqXHJcbiAgICogUmVzZXQgc3RhdGVcclxuICAgKi9cclxuICByZXNldFNlc3Npb24oc2Vzc2lvbjogUmVuZGVyU2Vzc2lvbik6IHZvaWQ7XHJcblxyXG4gIC8qKlxyXG4gICAqIFJldHJpZXZlIHBhZ2UgaW5mb3JtYXRpb24gb2YgY3VycmVudCBzZWxlY3RlZCBkb2N1bWVudFxyXG4gICAqL1xyXG4gIHJldHJpZXZlUGFnZXNJbmZvRnJvbVNlc3Npb24oc2Vzc2lvbjogUmVuZGVyU2Vzc2lvbik6IFBhZ2VJbmZvW107XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlbmRlciBhIFR5cHN0IGRvY3VtZW50IHRvIGNhbnZhcy5cclxuICAgKi9cclxuICByZW5kZXJDYW52YXMob3B0aW9uczogUmVuZGVyT3B0aW9uczxSZW5kZXJDYW52YXNPcHRpb25zPik6IFByb21pc2U8UmVuZGVyQ2FudmFzUmVzdWx0PjtcclxuXHJcbiAgLyoqXHJcbiAgICogUmVuZGVyIGEgVHlwc3QgZG9jdW1lbnQgdG8gY2FudmFzLlxyXG4gICAqIEBwYXJhbSB7UmVuZGVyT3B0aW9uczxSZW5kZXJUb0NhbnZhc09wdGlvbnM+fSBvcHRpb25zIC0gVGhlIG9wdGlvbnMgZm9yXHJcbiAgICogcmVuZGVyaW5nIGEgVHlwc3QgZG9jdW1lbnQgdG8gc3BlY2lmaWVkIGNvbnRhaW5lci5cclxuICAgKiBAcmV0dXJucyB7dm9pZH0gLSBUaGUgcmVzdWx0IG9mIHJlbmRlcmluZyBhIFR5cHN0IGRvY3VtZW50LlxyXG4gICAqIEBleGFtcGxlXHJcbiAgICogYGBgdHlwZXNjcmlwdFxyXG4gICAqIGxldCBmZXRjaERvYyA9IChwYXRoKSA9PiBmZXRjaChwYXRoKS50aGVuKFxyXG4gICAqICAgcmVzcG9uc2UgPT4gbmV3IFVpbnQ4QXJyYXkocmVzcG9uc2UuYXJyYXlCdWZmZXIoKSkpXHJcbiAgICogcmVuZGVyZXIucmVuZGVyVG9DYW52YXMoe1xyXG4gICAqICAgY29udGFpbmVyOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29udGFpbmVyJyksXHJcbiAgICogICBwaXhlbFBlclB0OiAzLFxyXG4gICAqICAgYmFja2dyb3VuZENvbG9yOiAnI2ZmZmZmZicsXHJcbiAgICogICBhcnRpZmFjdENvbnRlbnQ6IGF3YWl0IGZldGNoRG9jKCd0eXBzdC1tYWluLnNpci5pbicpLFxyXG4gICAqIH0pO1xyXG4gICAqIGBgYFxyXG4gICAqL1xyXG4gIHJlbmRlclRvQ2FudmFzKG9wdGlvbnM6IFJlbmRlck9wdGlvbnM8UmVuZGVyVG9DYW52YXNPcHRpb25zPik6IFByb21pc2U8dm9pZD47XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlbmRlciBhIFR5cHN0IGRvY3VtZW50IHRvIChub24taW5jcmVtZW50YWwpIHN2ZyBzdHJpbmcuXHJcbiAgICogQHBhcmFtIHtSZW5kZXJPcHRpb25zPFJlbmRlclN2Z09wdGlvbnM+fSBvcHRpb25zIC0gVGhlIG9wdGlvbnMgZm9yXHJcbiAgICogcmVuZGVyaW5nIGEgVHlwc3QgZG9jdW1lbnQgdG8gc3BlY2lmaWVkIGNvbnRhaW5lci5cclxuICAgKiBAcmV0dXJucyB7c3RyaW5nfSAtIFRoZSByZW5kZXJlZCBjb250ZW50LlxyXG4gICAqIEBleGFtcGxlXHJcbiAgICogYGBgdHlwZXNjcmlwdFxyXG4gICAqIGxldCBmZXRjaERvYyA9IChwYXRoKSA9PiBmZXRjaChwYXRoKS50aGVuKFxyXG4gICAqICAgcmVzcG9uc2UgPT4gbmV3IFVpbnQ4QXJyYXkocmVzcG9uc2UuYXJyYXlCdWZmZXIoKSkpXHJcbiAgICogY29uc3Qgc3ZnID0gcmVuZGVyZXIucmVuZGVyU3ZnKHtcclxuICAgKiAgIGFydGlmYWN0Q29udGVudDogYXdhaXQgZmV0Y2hEb2MoJ3R5cHN0LW1haW4uc2lyLmluJyksXHJcbiAgICogfSk7XHJcbiAgICogYGBgXHJcbiAgICovXHJcbiAgcmVuZGVyU3ZnKG9wdGlvbnM6IFJlbmRlck9wdGlvbnM8UmVuZGVyU3ZnT3B0aW9ucz4pOiBQcm9taXNlPHN0cmluZz47XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlbmRlciBhIFR5cHN0IGRvY3VtZW50IHRvIHN2Zy5cclxuICAgKiBAcGFyYW0ge1JlbmRlck9wdGlvbnM8UmVuZGVyVG9TdmdPcHRpb25zPn0gb3B0aW9ucyAtIFRoZSBvcHRpb25zIGZvclxyXG4gICAqIHJlbmRlcmluZyBhIFR5cHN0IGRvY3VtZW50IHRvIHNwZWNpZmllZCBjb250YWluZXIuXHJcbiAgICogQGV4YW1wbGVcclxuICAgKiBgYGB0eXBlc2NyaXB0XHJcbiAgICogbGV0IGZldGNoRG9jID0gKHBhdGgpID0+IGZldGNoKHBhdGgpLnRoZW4oXHJcbiAgICogICByZXNwb25zZSA9PiBuZXcgVWludDhBcnJheShyZXNwb25zZS5hcnJheUJ1ZmZlcigpKSlcclxuICAgKiByZW5kZXJlci5yZW5kZXJUb1N2Zyh7XHJcbiAgICogICBjb250YWluZXI6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb250YWluZXInKSxcclxuICAgKiAgIGFydGlmYWN0Q29udGVudDogYXdhaXQgZmV0Y2hEb2MoJ3R5cHN0LW1haW4uc2lyLmluJyksXHJcbiAgICogfSk7XHJcbiAgICogYGBgXHJcbiAgICovXHJcbiAgcmVuZGVyVG9Tdmcob3B0aW9uczogUmVuZGVyT3B0aW9uczxSZW5kZXJUb1N2Z09wdGlvbnM+KTogUHJvbWlzZTxib29sZWFuPjtcclxuXHJcbiAgLyoqXHJcbiAgICogUmV0dXJuIHNlbGVjdGVkIGN1cnJlbnQgc3ZnXHJcbiAgICovXHJcbiAgZ2V0Q3VzdG9tVjEob3B0aW9uczogUmVuZGVySW5TZXNzaW9uT3B0aW9uczx7fT4pOiBQcm9taXNlPGFueT47XHJcblxyXG4gIC8qKlxyXG4gICAqIGV4cGVyaW1lbnRhbFxyXG4gICAqL1xyXG4gIHJlbmRlclN2Z0RpZmYob3B0aW9uczogUmVuZGVySW5TZXNzaW9uT3B0aW9uczxSZW5kZXJTdmdPcHRpb25zPik6IHN0cmluZztcclxuXHJcbiAgLyoqXHJcbiAgICogTWFuaXB1bGF0ZSB0aGUgVHlwc3QgZG9jdW1lbnQgaW4gdGhlIHNlc3Npb24uXHJcbiAgICogU2VlIHtAbGluayBNYW5pcHVsYXRlRGF0YU9wdGlvbnN9IGZvciBtb3JlIGRldGFpbHMuXHJcbiAgICogQHBhcmFtIHtSZW5kZXJTZXNzaW9ufSBzZXNzaW9uIC0gVGhlIFR5cHN0IGRvY3VtZW50IHNlc3Npb24gdGhhdCBoYXMgYmVlblxyXG4gICAqIGNyZWF0ZWQgYnkgVHlwc3RSZW5kZXJlci5cclxuICAgKiBAcGFyYW0ge01hbmlwdWxhdGVEYXRhT3B0aW9uc30gb3B0cyAtIFRoZSBvcHRpb25zIGZvciBtYW5pcHVsYXRpbmcgdGhlXHJcbiAgICogVHlwc3QgZG9jdW1lbnQgaW4gdGhlIHNlc3Npb24uXHJcbiAgICpcclxuICAgKiBAZXhhbXBsZVxyXG4gICAqIHJlc2V0IHRoZSBkYXRhIHRvIHRoZSBpbml0aWFsIHN0YXRlLlxyXG4gICAqIGBgYHR5cGVzY3JpcHRcclxuICAgKiBjb25zdCBzZXNzaW9uID0gYXdhaXQgcmVuZGVyZXIuY3JlYXRlU2Vzc2lvbiguLi4pO1xyXG4gICAqIGF3YWl0IHJlbmRlcmVyLm1hbmlwdWxhdGVEYXRhKHNlc3Npb24sIHtcclxuICAgKiAgIGFjdGlvbjogJ3Jlc2V0JyxcclxuICAgKiAgIGRhdGE6IG5ldyBVaW50OEFycmF5KC4uLiksXHJcbiAgICogfSk7XHJcbiAgICogYGBgXHJcbiAgICogQGV4YW1wbGVcclxuICAgKiBtZXJnZSB0aGUgZGF0YSB0byB0aGUgY3VycmVudCBzdGF0ZS5cclxuICAgKiBgYGB0eXBlc2NyaXB0XHJcbiAgICogY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IHJlbmRlcmVyLmNyZWF0ZVNlc3Npb24oLi4uKTtcclxuICAgKiAvLy8gcmVzZXQgdGhlIGRhdGEgdG8gdGhlIGluaXRpYWwgc3RhdGVcclxuICAgKiBhd2FpdCByZW5kZXJlci5tYW5pcHVsYXRlRGF0YShzZXNzaW9uLCBkYXRhKCdyZXNldCcpKTtcclxuICAgKiAvLy8gbWVyZ2UgdGhlIGRhdGEgdG8gdGhlIGN1cnJlbnQgc3RhdGVcclxuICAgKiBhd2FpdCByZW5kZXJlci5tYW5pcHVsYXRlRGF0YShzZXNzaW9uLCBkYXRhKCdtZXJnZScpKTtcclxuICAgKiAvLy8gaW5jcmVtZW50YWxseSBtZXJnZSB0aGUgZGF0YSBhZ2FpblxyXG4gICAqIGF3YWl0IHJlbmRlcmVyLm1hbmlwdWxhdGVEYXRhKHNlc3Npb24sIGRhdGEoJ21lcmdlJykpO1xyXG4gICAqIGBgYFxyXG4gICAqL1xyXG4gIG1hbmlwdWxhdGVEYXRhKG9wdHM6IFJlbmRlckluU2Vzc2lvbk9wdGlvbnM8TWFuaXB1bGF0ZURhdGFPcHRpb25zPik6IHZvaWQ7XHJcblxyXG4gIC8qKlxyXG4gICAqIFJ1biBhIGZ1bmN0aW9uIHdpdGggYSBzZXNzaW9uLCBhbmQgdGhlIHNlc3Npb24gaXMgb25seSBhdmFpbGFibGUgZHVyaW5nXHJcbiAgICogdGhlIGZ1bmN0aW9uIGNhbGwuXHJcbiAgICpcclxuICAgKiB0aGUgbGlmZXRpbWUgb2Ygc2Vzc2lvbiBpcyBxdWl0ZSBidWctcHJvbmUsIHNvIHdlIGN1cnJlbnQgZG9lcyBub3QgbWFrZSBpdFxyXG4gICAqIGxvbmdlciBsaXZlIHRoYW4gdGhlIGZ1bmN0aW9uIGNhbGwuXHJcbiAgICogQHBhcmFtIHtmdW5jdGlvbn0gZm4gLSBUaGUgZnVuY3Rpb24gdG8gcnVuIHdpdGggYSBzZXNzaW9uLlxyXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPFQ+fSAtIFRoZSByZXN1bHQgb2YgdGhlIGZ1bmN0aW9uLlxyXG4gICAqIEBleGFtcGxlXHJcbiAgICogcnVuIGEgZnVuY3Rpb24gd2l0aCBhbiBzZXNzaW9uIHdpdGggZW1wdHkgc3RhdGUuXHJcbiAgICpcclxuICAgKiBgYGB0eXBlc2NyaXB0XHJcbiAgICogY29uc3QgcmVzID0gYXdhaXQgcmVuZGVyZXIucnVuV2l0aFNlc3Npb24oYXN5bmMgc2Vzc2lvbiA9PiB7XHJcbiAgICogICBhd2FpdCByZW5kZXJlci5tYW5pcHVsYXRlRGF0YShzZXNzaW9uLCBkYXRhKCdyZXNldCcpKTtcclxuICAgKiAgIHJldHVybiBhd2FpdCByZW5kZXJlci5yZW5kZXJUb0NhbnZhcyh7XHJcbiAgICogICAgIHJlbmRlclNlc3Npb246IHNlc3Npb24sXHJcbiAgICogICAgIGNvbnRhaW5lcjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbnRhaW5lcicpLFxyXG4gICAqICAgICBiYWNrZ3JvdW5kQ29sb3I6ICcjZmZmZmZmJyxcclxuICAgKiAgIH0pO1xyXG4gICAqIH0pO1xyXG4gICAqIGBgYFxyXG4gICAqXHJcbiAgICogQGV4YW1wbGVcclxuICAgKiBydW4gYSBmdW5jdGlvbiB3aXRoIGFuIHNlc3Npb24gd2l0aCBpbml0aWFsIHN0YXRlLlxyXG4gICAqXHJcbiAgICogYGBgdHlwZXNjcmlwdFxyXG4gICAqIGNvbnN0IHJlcyA9IGF3YWl0IHJlbmRlcmVyLnJ1bldpdGhTZXNzaW9uKHtcclxuICAgKiAgIGZvcm1hdDogJ3ZlY3RvcicsXHJcbiAgICogICBhcnRpZmFjdENvbnRlbnQ6IG5ldyBVaW50OEFycmF5KC4uLiksXHJcbiAgICogfSwgd29ya1dpdGhTZXNzaW9uKHNlc3Npb24pKTtcclxuICAgKiBgYGBcclxuICAgKlxyXG4gICAqIEBleGFtcGxlXHJcbiAgICogbGVhayB0aGUgbGlmZSBzcGFuIG9mIHNlc3Npb24gKG5lZWQgdHlwZXNjcmlwdCA+PSB2NS4yKVxyXG4gICAqXHJcbiAgICogYGBgdHlwZXNjcmlwdFxyXG4gICAqIGNsYXNzIFN0YWNrZWRTZXNzaW9uIHtcclxuICAgKiAgIHNlc3Npb246IFJlbmRlclNlc3Npb247XHJcbiAgICogICBwcml2YXRlIHJlc29sdmU6IChzZXNzaW9uOiBSZW5kZXJTZXNzaW9uKSA9PiB2b2lkO1xyXG4gICAqICAgW1N5bWJvbC5kaXNwb3NlXSgpIHtcclxuICAgKiAgICAgdGhpcy5yZXNvbHZlKCk7XHJcbiAgICogICB9XHJcbiAgICogICBzdGF0aWMgYXN5bmMgY3JlYXRlKCkge1xyXG4gICAqICAgICByZXR1cm4gbmV3IFByb21pc2U8U3RhY2tlZFNlc3Npb24+KHJlc29sdmUgPT4ge1xyXG4gICAqICAgICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCByZW5kZXJlci5ydW5XaXRoU2Vzc2lvbihzZXNzaW9uID0+IHtcclxuICAgKiAgICAgICBjb25zdCBzdGFja2VkU2Vzc2lvbiA9IG5ldyBTdGFja2VkU2Vzc2lvbigpO1xyXG4gICAqICAgICAgIHN0YWNrZWRTZXNzaW9uLnNlc3Npb24gPSBzZXNzaW9uO1xyXG4gICAqICAgICAgIHN0YWNrZWRTZXNzaW9uLnJlc29sdmUgPSByZXNvbHZlO1xyXG4gICAqICAgICAgIHJldHVybiBzdGFja2VkU2Vzc2lvbjtcclxuICAgKiAgICAgfSk7XHJcbiAgICogICB9XHJcbiAgICogfVxyXG4gICAqXHJcbiAgICoge1xyXG4gICAqICAgYXdhaXQgdXNpbmcgc2Vzc2lvbiA9IFN0YWNrZWRTZXNzaW9uLmNyZWF0ZSgpO1xyXG4gICAqICAgLy8vIGRvIHNvbWV0aGluZyB3aXRoIHNlc3Npb25cclxuICAgKiB9XHJcbiAgICogYGBgXHJcbiAgICovXHJcbiAgcnVuV2l0aFNlc3Npb248VD4oZm46IChzZXNzaW9uOiBSZW5kZXJTZXNzaW9uKSA9PiBQcm9taXNlPFQ+KTogUHJvbWlzZTxUPjtcclxuICBydW5XaXRoU2Vzc2lvbjxUPihcclxuICAgIG9wdGlvbnM6IENyZWF0ZVNlc3Npb25PcHRpb25zLFxyXG4gICAgZm46IChzZXNzaW9uOiBSZW5kZXJTZXNzaW9uKSA9PiBQcm9taXNlPFQ+LFxyXG4gICk6IFByb21pc2U8VD47XHJcblxyXG4gIGNyZWF0ZVdvcmtlclYwKHdvcmtlcjogV29ya2VyKTogUHJvbWlzZTxUeXBzdFdvcmtlcj47XHJcblxyXG4gIHJlbmRlckRvbShvcHRpb25zOiBSZW5kZXJJblNlc3Npb25PcHRpb25zPE1vdW50RG9tT3B0aW9ucz4pOiBQcm9taXNlPFR5cHN0RG9tRG9jdW1lbnQ+O1xyXG5cclxuICAvKipcclxuICAgKiBhbGlhcyB0byB7QGxpbmsgVHlwc3RSZW5kZXJlciNyZW5kZXJUb0NhbnZhc30sIHdpbGwgcmVtb3ZlIGluIHYwLjUuMFxyXG4gICAqIEBkZXByZWNhdGVkXHJcbiAgICogdXNlIHtAbGluayByZW5kZXJUb0NhbnZhc30gaW5zdGVhZFxyXG4gICAqL1xyXG4gIHJlbmRlcihvcHRpb25zOiBSZW5kZXJPcHRpb25zPFJlbmRlclRvQ2FudmFzT3B0aW9ucz4pOiBQcm9taXNlPHZvaWQ+O1xyXG59XHJcblxyXG5jb25zdCBnUmVuZGVyZXJNb2R1bGUgPSAobW9kdWxlOiB0eXBlb2YgdHlwc3QpID0+XHJcbiAgbmV3IExhenlXYXNtTW9kdWxlKGFzeW5jIChiaW4/OiBhbnkpID0+IHtcclxuICAgIHJldHVybiBhd2FpdCBtb2R1bGUuZGVmYXVsdChiaW4pO1xyXG4gIH0pO1xyXG5cclxuLyoqXHJcbiAqIGNyZWF0ZSBhIFR5cHN0IHJlbmRlcmVyLlxyXG4gKiBAcmV0dXJucyB7VHlwc3RSZW5kZXJlcn0gLSBUaGUgVHlwc3QgcmVuZGVyZXIuXHJcbiAqIEBleGFtcGxlXHJcbiAqIGBgYHR5cGVzY3JpcHRcclxuICogaW1wb3J0IHsgY3JlYXRlVHlwc3RSZW5kZXJlciB9IGZyb20gJ3R5cHN0JztcclxuICogY29uc3QgcmVuZGVyZXIgPSBjcmVhdGVUeXBzdFJlbmRlcmVyKCk7XHJcbiAqIGF3YWl0IHJlbmRlcmVyLmluaXQoKTtcclxuICogYXdhaXQgcmVuZGVyZXIucmVuZGVyKHtcclxuICogICBjb250YWluZXI6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb250YWluZXInKSxcclxuICogICBhcnRpZmFjdENvbnRlbnQ6ICd7IC4uLiB9JyxcclxuICogfSk7XHJcbiAqIGBgYFxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVR5cHN0UmVuZGVyZXIoKTogVHlwc3RSZW5kZXJlciB7XHJcbiAgcmV0dXJuIG5ldyBUeXBzdFJlbmRlcmVyRHJpdmVyKCk7XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgVHlwc3RTdmdSZW5kZXJlciB7XHJcbiAgaW5pdChvcHRpb25zPzogUGFydGlhbDxJbml0T3B0aW9ucz4pOiBQcm9taXNlPHZvaWQ+O1xyXG5cclxuICAvKipcclxuICAgKiBDcmVhdGUgYSBzdmcgc2Vzc2lvbi5cclxuICAgKiBAZGVwcmVjYXRlZFxyXG4gICAqIHVzZSB7QGxpbmsgVHlwc3RSZW5kZXJlclsncnVuV2l0aFNlc3Npb24nXX0gaW5zdGVhZFxyXG4gICAqL1xyXG4gIGNyZWF0ZU1vZHVsZShiOiBVaW50OEFycmF5KTogUHJvbWlzZTxSZW5kZXJTZXNzaW9uPjtcclxuXHJcbiAgLyoqXHJcbiAgICogUmVuZGVyIGEgVHlwc3QgZG9jdW1lbnQgdG8gc3ZnLlxyXG4gICAqIEBwYXJhbSB7UmVuZGVyT3B0aW9uczxSZW5kZXJUb1N2Z09wdGlvbnM+fSBvcHRpb25zIC0gVGhlIG9wdGlvbnMgZm9yXHJcbiAgICogcmVuZGVyaW5nIGEgVHlwc3QgZG9jdW1lbnQgdG8gc3BlY2lmaWVkIGNvbnRhaW5lci5cclxuICAgKiBAcmV0dXJucyB7dm9pZH0gLSBUaGUgcmVzdWx0IG9mIHJlbmRlcmluZyBhIFR5cHN0IGRvY3VtZW50LlxyXG4gICAqIEBleGFtcGxlXHJcbiAgICogYGBgdHlwZXNjcmlwdFxyXG4gICAqIGxldCBmZXRjaERvYyA9IChwYXRoKSA9PiBmZXRjaChwYXRoKS50aGVuKFxyXG4gICAqICAgcmVzcG9uc2UgPT4gbmV3IFVpbnQ4QXJyYXkocmVzcG9uc2UuYXJyYXlCdWZmZXIoKSkpXHJcbiAgICogcmVuZGVyZXIucmVuZGVyVG9Tdmcoe1xyXG4gICAqICAgY29udGFpbmVyOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29udGFpbmVyJyksXHJcbiAgICogICBhcnRpZmFjdENvbnRlbnQ6IGF3YWl0IGZldGNoRG9jKCd0eXBzdC1tYWluLnNpci5pbicpLFxyXG4gICAqIH0pO1xyXG4gICAqIGBgYFxyXG4gICAqL1xyXG4gIHJlbmRlclRvU3ZnKG9wdGlvbnM6IFJlbmRlck9wdGlvbnM8UmVuZGVyVG9TdmdPcHRpb25zPik6IFByb21pc2U8Ym9vbGVhbj47XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBAZGVwcmVjYXRlZFxyXG4gKiB1c2Uge0BsaW5rIGNyZWF0ZVR5cHN0UmVuZGVyZXJ9IGluc3RlYWRcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVUeXBzdFN2Z1JlbmRlcmVyKCk6IFR5cHN0U3ZnUmVuZGVyZXIge1xyXG4gIHJldHVybiBuZXcgVHlwc3RSZW5kZXJlckRyaXZlcigpO1xyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVuZGVyZXJCdWlsZEluZm8oKTogUHJvbWlzZTxhbnk+IHtcclxuICBjb25zdCByZW5kZXJNb2R1bGUgPSBhd2FpdCBpbXBvcnQoJ0BteXJpYWRkcmVhbWluL3R5cHN0LXRzLXJlbmRlcmVyJyk7XHJcbiAgcmV0dXJuIHJlbmRlck1vZHVsZS5yZW5kZXJlcl9idWlsZF9pbmZvKCk7XHJcbn1cclxuXHJcbmxldCB3YXJuT25jZUNhbnZhc1NldCA9IHRydWU7XHJcblxyXG4vKiogQGludGVybmFsICovXHJcbmV4cG9ydCBjbGFzcyBUeXBzdFJlbmRlcmVyRHJpdmVyIHtcclxuICByZW5kZXJlcjogdHlwc3QuVHlwc3RSZW5kZXJlcjtcclxuICByZW5kZXJlckpzOiB0eXBlb2YgdHlwc3Q7XHJcblxyXG4gIGNvbnN0cnVjdG9yKCkge31cclxuXHJcbiAgYXN5bmMgaW5pdChvcHRpb25zPzogUGFydGlhbDxJbml0T3B0aW9ucz4pOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIHRoaXMucmVuZGVyZXJKcyA9IGF3YWl0IChvcHRpb25zPy5nZXRXcmFwcGVyPy4oKSB8fCBpbXBvcnQoJ0BteXJpYWRkcmVhbWluL3R5cHN0LXRzLXJlbmRlcmVyJykpO1xyXG4gICAgY29uc3QgVHlwc3RSZW5kZXJlckJ1aWxkZXIgPSB0aGlzLnJlbmRlcmVySnMuVHlwc3RSZW5kZXJlckJ1aWxkZXI7XHJcbiAgICB0aGlzLnJlbmRlcmVyID0gYXdhaXQgYnVpbGRDb21wb25lbnQoXHJcbiAgICAgIG9wdGlvbnMsXHJcbiAgICAgIGdSZW5kZXJlck1vZHVsZSh0aGlzLnJlbmRlcmVySnMpLFxyXG4gICAgICBUeXBzdFJlbmRlcmVyQnVpbGRlcixcclxuICAgICAge30sXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgbG9hZEdseXBoUGFjayhfcGFjazogdW5rbm93bik6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgLy8gdGhpcy5yZW5kZXJlci5sb2FkX2dseXBoX3BhY2socGFjayk7XHJcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGNyZWF0ZU9wdGlvbnNUb1J1c3Qob3B0aW9uczogUGFydGlhbDxDcmVhdGVTZXNzaW9uT3B0aW9ucz4pOiB0eXBzdC5DcmVhdGVTZXNzaW9uT3B0aW9ucyB7XHJcbiAgICBjb25zdCBydXN0T3B0aW9ucyA9IG5ldyB0aGlzLnJlbmRlcmVySnMuQ3JlYXRlU2Vzc2lvbk9wdGlvbnMoKTtcclxuXHJcbiAgICBpZiAob3B0aW9ucy5mb3JtYXQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICBydXN0T3B0aW9ucy5mb3JtYXQgPSBvcHRpb25zLmZvcm1hdDtcclxuICAgIH1cclxuXHJcbiAgICBpZiAob3B0aW9ucy5hcnRpZmFjdENvbnRlbnQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICBydXN0T3B0aW9ucy5hcnRpZmFjdF9jb250ZW50ID0gb3B0aW9ucy5hcnRpZmFjdENvbnRlbnQ7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHJ1c3RPcHRpb25zO1xyXG4gIH1cclxuXHJcbiAgY2FudmFzT3B0aW9uc1RvUnVzdChvcHRpb25zOiBSZW5kZXJDYW52YXNPcHRpb25zKTogdHlwc3QuUmVuZGVyUGFnZUltYWdlT3B0aW9ucyB7XHJcbiAgICBjb25zdCBydXN0T3B0aW9ucyA9IG5ldyB0aGlzLnJlbmRlcmVySnMuUmVuZGVyUGFnZUltYWdlT3B0aW9ucygpO1xyXG4gICAgaWYgKG9wdGlvbnMucGFnZU9mZnNldCA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcigncGFnZU9mZnNldCBpcyByZXF1aXJlZCBpbiByZWZsZXhvIHYwLjUuMCcpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcnVzdE9wdGlvbnMucGFnZV9vZmYgPSBvcHRpb25zLnBhZ2VPZmZzZXQ7XHJcbiAgICB9XHJcbiAgICBpZiAob3B0aW9ucy5jYWNoZUtleSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIHJ1c3RPcHRpb25zLmNhY2hlX2tleSA9IG9wdGlvbnMuY2FjaGVLZXk7XHJcbiAgICB9XHJcbiAgICBpZiAob3B0aW9ucy5iYWNrZ3JvdW5kQ29sb3IgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICBydXN0T3B0aW9ucy5iYWNrZ3JvdW5kX2NvbG9yID0gb3B0aW9ucy5iYWNrZ3JvdW5kQ29sb3I7XHJcbiAgICB9XHJcbiAgICBpZiAob3B0aW9ucy5waXhlbFBlclB0ICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgcnVzdE9wdGlvbnMucGl4ZWxfcGVyX3B0ID0gb3B0aW9ucy5waXhlbFBlclB0O1xyXG4gICAgfVxyXG4gICAgaWYgKG9wdGlvbnMuZGF0YVNlbGVjdGlvbiAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIGxldCBlbmNvZGVkID0gMDtcclxuICAgICAgaWYgKG9wdGlvbnMuZGF0YVNlbGVjdGlvbi5ib2R5KSB7XHJcbiAgICAgICAgZW5jb2RlZCB8PSAxIDw8IDA7XHJcbiAgICAgIH0gZWxzZSBpZiAob3B0aW9ucy5jYW52YXMgJiYgd2Fybk9uY2VDYW52YXNTZXQpIHtcclxuICAgICAgICB3YXJuT25jZUNhbnZhc1NldCA9IGZhbHNlO1xyXG4gICAgICAgIGNvbnNvbGUud2FybignZGF0YVNlbGVjdGlvbi5ib2R5IGlzIG5vdCBzZXQgYnV0IHByb3ZpZGluZyBjYW52YXMgZm9yIGJvZHknKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAob3B0aW9ucy5kYXRhU2VsZWN0aW9uLnRleHQgfHwgb3B0aW9ucy5kYXRhU2VsZWN0aW9uLmFubm90YXRpb24pIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdkYXRhU2VsZWN0aW9uLnRleHQgYW5kIGRhdGFTZWxlY3Rpb24uYW5ub3RhdGlvbiBhcmUgZGVwcmVjYXRlZCcpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChvcHRpb25zLmRhdGFTZWxlY3Rpb24uc2VtYW50aWNzKSB7XHJcbiAgICAgICAgZW5jb2RlZCB8PSAxIDw8IDM7XHJcbiAgICAgIH1cclxuICAgICAgcnVzdE9wdGlvbnMuZGF0YV9zZWxlY3Rpb24gPSBlbmNvZGVkO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHJ1c3RPcHRpb25zO1xyXG4gIH1cclxuXHJcbiAgcmV0cmlldmVQYWdlc0luZm9Gcm9tU2Vzc2lvbihzZXNzaW9uOiBSZW5kZXJTZXNzaW9uKTogUGFnZUluZm9bXSB7XHJcbiAgICByZXR1cm4gc2Vzc2lvbi5yZXRyaWV2ZVBhZ2VzSW5mbygpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVuZGVyIGEgVHlwc3QgZG9jdW1lbnQgdG8gY2FudmFzLlxyXG4gICAqL1xyXG4gIHJlbmRlckNhbnZhcyhvcHRpb25zOiBSZW5kZXJPcHRpb25zPFJlbmRlckNhbnZhc09wdGlvbnM+KTogUHJvbWlzZTxSZW5kZXJDYW52YXNSZXN1bHQ+IHtcclxuICAgIHJldHVybiB0aGlzLndpdGhpbk9wdGlvblNlc3Npb24ob3B0aW9ucywgYXN5bmMgc2Vzc2lvblJlZiA9PiB7XHJcbiAgICAgIHJldHVybiB0aGlzLnJlbmRlcmVyLnJlbmRlcl9wYWdlX3RvX2NhbnZhcyhcclxuICAgICAgICBzZXNzaW9uUmVmW2tPYmplY3RdLFxyXG4gICAgICAgIG9wdGlvbnMuY2FudmFzIHx8IHVuZGVmaW5lZCxcclxuICAgICAgICB0aGlzLmNhbnZhc09wdGlvbnNUb1J1c3Qob3B0aW9ucyksXHJcbiAgICAgICk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8vIGFzeW5jIHJlbmRlclBkZihhcnRpZmFjdENvbnRlbnQ6IHN0cmluZyk6IFByb21pc2U8VWludDhBcnJheT4ge1xyXG4gIC8vIHJldHVybiB0aGlzLnJlbmRlcmVyLnJlbmRlcl90b19wZGYoYXJ0aWZhY3RDb250ZW50KTtcclxuICAvLyB9XHJcblxyXG4gIHByaXZhdGUgYXN5bmMgaW5BbmltYXRpb25GcmFtZTxUPihmbjogKCkgPT4gUHJvbWlzZTxUPik6IFByb21pc2U8VD4ge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgcmVzb2x2ZShmbigpKTtcclxuICAgICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgICByZWplY3QoZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhc3luYyByZW5kZXJEaXNwbGF5TGF5ZXIoXHJcbiAgICBzZXNzaW9uOiBSZW5kZXJTZXNzaW9uLFxyXG4gICAgY2FudmFzTGlzdDogSFRNTENhbnZhc0VsZW1lbnRbXSxcclxuICAgIG9wdGlvbnM6IFJlbmRlclRvQ2FudmFzT3B0aW9ucyxcclxuICApOiBQcm9taXNlPFJlbmRlckNhbnZhc1Jlc3VsdFtdPiB7XHJcbiAgICBjb25zdCBwYWdlc19pbmZvID0gc2Vzc2lvbltrT2JqZWN0XS5wYWdlc19pbmZvO1xyXG4gICAgY29uc3QgcGFnZV9jb3VudCA9IHBhZ2VzX2luZm8ucGFnZV9jb3VudDtcclxuXHJcbiAgICBjb25zdCBkb1JlbmRlciA9IGFzeW5jIChpOiBudW1iZXIsIHBhZ2Vfb2ZmOiBudW1iZXIpID0+IHtcclxuICAgICAgY29uc3QgY2FudmFzID0gY2FudmFzTGlzdFtpXTtcclxuICAgICAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XHJcbiAgICAgIGlmICghY3R4KSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdjYW52YXMgY29udGV4dCBpcyBudWxsJyk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMucmVuZGVyQ2FudmFzKHtcclxuICAgICAgICAuLi5vcHRpb25zLFxyXG4gICAgICAgIGNhbnZhczogY3R4LFxyXG4gICAgICAgIHJlbmRlclNlc3Npb246IHNlc3Npb24sXHJcbiAgICAgICAgcGFnZU9mZnNldDogcGFnZV9vZmYsXHJcbiAgICAgIH0pO1xyXG4gICAgfTtcclxuXHJcbiAgICBjb25zdCB0ID0gcGVyZm9ybWFuY2Uubm93KCk7XHJcbiAgICBjb25zdCB0ZXh0Q29udGVudExpc3QgPSBhd2FpdCAoYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCByZXN1bHRzOiBSZW5kZXJDYW52YXNSZXN1bHRbXSA9IFtdO1xyXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHBhZ2VfY291bnQ7IGkrKykge1xyXG4gICAgICAgIHJlc3VsdHMucHVzaChhd2FpdCB0aGlzLmluQW5pbWF0aW9uRnJhbWUoKCkgPT4gZG9SZW5kZXIoaSwgaSkpKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIHJlc3VsdHM7XHJcbiAgICB9KSgpO1xyXG4gICAgY29uc3QgdDIgPSBwZXJmb3JtYW5jZS5ub3coKTtcclxuXHJcbiAgICBjb25zb2xlLmxvZyhgZGlzcGxheSBsYXllciB1c2VkOiByZW5kZXIgPSAkeyh0MiAtIHQpLnRvRml4ZWQoMSl9bXNgKTtcclxuXHJcbiAgICByZXR1cm4gdGV4dENvbnRlbnRMaXN0O1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSByZW5kZXJUZXh0TGF5ZXIobGF5ZXJMaXN0OiBIVE1MRGl2RWxlbWVudFtdLCB0ZXh0U291cmNlTGlzdDogUmVuZGVyQ2FudmFzUmVzdWx0W10pIHtcclxuICAgIGNvbnN0IHQyID0gcGVyZm9ybWFuY2Uubm93KCk7XHJcbiAgICBsYXllckxpc3QuZm9yRWFjaCgobGF5ZXIsIGkpID0+IHtcclxuICAgICAgbGF5ZXIuaW5uZXJIVE1MID0gdGV4dFNvdXJjZUxpc3RbaV0uaHRtbFNlbWFudGljc1swXTtcclxuICAgIH0pO1xyXG4gICAgY29uc3QgdDMgPSBwZXJmb3JtYW5jZS5ub3coKTtcclxuICAgIGNvbnNvbGUubG9nKGB0ZXh0IGxheWVyIHVzZWQ6IHJlbmRlciA9ICR7KHQzIC0gdDIpLnRvRml4ZWQoMSl9bXNgKTtcclxuICB9XHJcblxyXG4gIGFzeW5jIHJlbmRlcihvcHRpb25zOiBSZW5kZXJPcHRpb25zPFJlbmRlclRvQ2FudmFzT3B0aW9ucz4pOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIGlmICgnZm9ybWF0JyBpbiBvcHRpb25zKSB7XHJcbiAgICAgIGlmIChvcHRpb25zLmZvcm1hdCAhPT0gJ3ZlY3RvcicpIHtcclxuICAgICAgICBjb25zdCBhcnRpZmFjdEZvcm1hdHMgPSBbJ3NlcmRlX2pzb24nLCAnanMnLCAnaXInXSBhcyBjb25zdDtcclxuICAgICAgICBpZiAoYXJ0aWZhY3RGb3JtYXRzLmluY2x1ZGVzKG9wdGlvbnMuZm9ybWF0IGFzIGFueSkpIHtcclxuICAgICAgICAgIC8vIGRlcHJlY2F0ZWRcclxuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgZGVwcmVjYXRlZCBmb3JtYXQgJHtvcHRpb25zLmZvcm1hdH0sIHBsZWFzZSB1c2UgdmVjdG9yIGZvcm1hdGApO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB0aGlzLnJlbmRlclRvQ2FudmFzKG9wdGlvbnMpO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgcmVuZGVyRG9tKG9wdGlvbnM6IFJlbmRlckluU2Vzc2lvbk9wdGlvbnM8TW91bnREb21PcHRpb25zPik6IFByb21pc2U8VHlwc3REb21Eb2N1bWVudD4ge1xyXG4gICAgaWYgKCdmb3JtYXQnIGluIG9wdGlvbnMpIHtcclxuICAgICAgaWYgKG9wdGlvbnMuZm9ybWF0ICE9PSAndmVjdG9yJykge1xyXG4gICAgICAgIGNvbnN0IGFydGlmYWN0Rm9ybWF0cyA9IFsnc2VyZGVfanNvbicsICdqcycsICdpciddIGFzIGNvbnN0O1xyXG4gICAgICAgIGlmIChhcnRpZmFjdEZvcm1hdHMuaW5jbHVkZXMob3B0aW9ucy5mb3JtYXQgYXMgYW55KSkge1xyXG4gICAgICAgICAgLy8gZGVwcmVjYXRlZFxyXG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBkZXByZWNhdGVkIGZvcm1hdCAke29wdGlvbnMuZm9ybWF0fSwgcGxlYXNlIHVzZSB2ZWN0b3IgZm9ybWF0YCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHRoaXMud2l0aGluT3B0aW9uU2Vzc2lvbihvcHRpb25zLCBhc3luYyBzZXNzaW9uUmVmID0+IHtcclxuICAgICAgY29uc3QgdCA9IG5ldyBUeXBzdERvbURvY3VtZW50KHtcclxuICAgICAgICAuLi5vcHRpb25zLFxyXG4gICAgICAgIHJlbmRlck1vZGU6ICdkb20nLFxyXG4gICAgICAgIGhvb2tlZEVsZW06IG9wdGlvbnMuY29udGFpbmVyLFxyXG4gICAgICAgIGtNb2R1bGU6IHNlc3Npb25SZWYsXHJcbiAgICAgICAgcmVuZGVyZXI6IHRoaXMsXHJcbiAgICAgIH0pO1xyXG4gICAgICB0O1xyXG4gICAgICBhd2FpdCB0LmltcGwubW91bnREb20ob3B0aW9ucy5waXhlbFBlclB0KTtcclxuICAgICAgcmV0dXJuIHQ7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGFzeW5jIHJlbmRlclRvQ2FudmFzKG9wdGlvbnM6IFJlbmRlck9wdGlvbnM8UmVuZGVyVG9DYW52YXNPcHRpb25zPik6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgbGV0IHNlc3Npb246IFJlbmRlclNlc3Npb247XHJcbiAgICBsZXQgcmVuZGVyUGFnZVJlc3VsdHM6IFJlbmRlckNhbnZhc1Jlc3VsdFtdO1xyXG4gICAgY29uc3QgbW91bnRDb250YWluZXIgPSBvcHRpb25zLmNvbnRhaW5lcjtcclxuICAgIG1vdW50Q29udGFpbmVyLnN0eWxlLnZpc2liaWxpdHkgPSAnaGlkZGVuJztcclxuXHJcbiAgICBjb25zdCBkb1JlbmRlckRpc3BsYXlMYXllciA9IGFzeW5jIChcclxuICAgICAgY2FudmFzTGlzdDogSFRNTENhbnZhc0VsZW1lbnRbXSxcclxuICAgICAgcmVzZXRMYXlvdXQ6ICgpID0+IHZvaWQsXHJcbiAgICApID0+IHtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICByZW5kZXJQYWdlUmVzdWx0cyA9IGF3YWl0IHRoaXMucmVuZGVyRGlzcGxheUxheWVyKHNlc3Npb24sIGNhbnZhc0xpc3QsIG9wdGlvbnMpO1xyXG4gICAgICAgIHJlc2V0TGF5b3V0KCk7XHJcbiAgICAgIH0gZmluYWxseSB7XHJcbiAgICAgICAgbW91bnRDb250YWluZXIuc3R5bGUudmlzaWJpbGl0eSA9ICd2aXNpYmxlJztcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICByZXR1cm4gdGhpcy53aXRoaW5PcHRpb25TZXNzaW9uKG9wdGlvbnMsIGFzeW5jIHNlc3Npb25SZWYgPT4ge1xyXG4gICAgICBzZXNzaW9uID0gc2Vzc2lvblJlZjtcclxuICAgICAgaWYgKHNlc3Npb25ba09iamVjdF0ucGFnZXNfaW5mby5wYWdlX2NvdW50ID09PSAwKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBObyBwYWdlIGZvdW5kIGluIHNlc3Npb25gKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKG9wdGlvbnMucGl4ZWxQZXJQdCAhPT0gdW5kZWZpbmVkICYmIG9wdGlvbnMucGl4ZWxQZXJQdCA8PSAwKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxyXG4gICAgICAgICAgJ0ludmFsaWQgdHlwc3QuUmVuZGVyT3B0aW9ucy5waXhlbFBlclB0LCBzaG91bGQgYmUgYSBwb3NpdGl2ZSBudW1iZXIgJyArXHJcbiAgICAgICAgICAgIG9wdGlvbnMucGl4ZWxQZXJQdCxcclxuICAgICAgICApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBsZXQgYmFja2dyb3VuZENvbG9yID0gb3B0aW9ucy5iYWNrZ3JvdW5kQ29sb3I7XHJcbiAgICAgIGlmIChiYWNrZ3JvdW5kQ29sb3IgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIGlmICghL14jWzAtOWEtZl17Nn0kLy50ZXN0KGJhY2tncm91bmRDb2xvcikpIHtcclxuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcclxuICAgICAgICAgICAgJ0ludmFsaWQgdHlwc3QuYmFja2dyb3VuZENvbG9yIGNvbG9yIGZvciBtYXRjaGluZyBeIz9bMC05YS1mXXs2fSQgJyArIGJhY2tncm91bmRDb2xvcixcclxuICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICBzZXNzaW9uLnBpeGVsUGVyUHQgPSBvcHRpb25zLnBpeGVsUGVyUHQgPz8gVHlwc3REZWZhdWx0UGFyYW1zLlBJWEVMX1BFUl9QVDtcclxuICAgICAgc2Vzc2lvbi5iYWNrZ3JvdW5kQ29sb3IgPSBiYWNrZ3JvdW5kQ29sb3IgPz8gJyNmZmZmZmYnO1xyXG5cclxuICAgICAgY29uc3QgdCA9IHBlcmZvcm1hbmNlLm5vdygpO1xyXG5cclxuICAgICAgY29uc3QgcGFnZVZpZXcgPSBuZXcgUmVuZGVyVmlldyhcclxuICAgICAgICB0aGlzLnJldHJpZXZlUGFnZXNJbmZvRnJvbVNlc3Npb24oc2Vzc2lvbiksXHJcbiAgICAgICAgbW91bnRDb250YWluZXIsXHJcbiAgICAgICAgb3B0aW9ucyxcclxuICAgICAgKTtcclxuICAgICAgY29uc3QgdDIgPSBwZXJmb3JtYW5jZS5ub3coKTtcclxuXHJcbiAgICAgIGNvbnNvbGUubG9nKGBsYXllciB1c2VkOiByZXRyaWV2ZSA9ICR7KHQyIC0gdCkudG9GaXhlZCgxKX1tc2ApO1xyXG5cclxuICAgICAgYXdhaXQgZG9SZW5kZXJEaXNwbGF5TGF5ZXIocGFnZVZpZXcuY2FudmFzTGlzdCwgKCkgPT4gcGFnZVZpZXcucmVzZXRMYXlvdXQoKSk7XHJcbiAgICAgIHRoaXMucmVuZGVyVGV4dExheWVyKHBhZ2VWaWV3LnRleHRMYXllckxpc3QsIHJlbmRlclBhZ2VSZXN1bHRzKTtcclxuXHJcbiAgICAgIHJldHVybjtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgY3JlYXRlTW9kdWxlKGI/OiBVaW50OEFycmF5KTogUHJvbWlzZTxSZW5kZXJTZXNzaW9uPiB7XHJcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKFxyXG4gICAgICBuZXcgUmVuZGVyU2Vzc2lvbihcclxuICAgICAgICB0aGlzLFxyXG4gICAgICAgIHRoaXMucmVuZGVyZXIuY3JlYXRlX3Nlc3Npb24oXHJcbiAgICAgICAgICBiICYmXHJcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlT3B0aW9uc1RvUnVzdCh7XHJcbiAgICAgICAgICAgICAgZm9ybWF0OiAndmVjdG9yJyxcclxuICAgICAgICAgICAgICBhcnRpZmFjdENvbnRlbnQ6IGIsXHJcbiAgICAgICAgICAgIH0pLFxyXG4gICAgICAgICksXHJcbiAgICAgICksXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgY3JlYXRlV29ya2VyVjAod29ya2VyOiBXb3JrZXIpIHtcclxuICAgIHJldHVybiBuZXcgVHlwc3RXb3JrZXIodGhpcywgYXdhaXQgdGhpcy5yZW5kZXJlci5jcmVhdGVfd29ya2VyKHdvcmtlcikpO1xyXG4gIH1cclxuXHJcbiAgd29ya2VyQnJpZGdlKCkge1xyXG4gICAgcmV0dXJuIHRoaXMucmVuZGVyZXIuY3JlYXRlX3dvcmtlcl9icmlkZ2UoKTtcclxuICB9XHJcblxyXG4gIHJlbmRlclN2ZyhvcHRpb25zOiBSZW5kZXJPcHRpb25zPFJlbmRlclN2Z09wdGlvbnM+LCBjb250YWluZXI/OiBhbnkpOiBQcm9taXNlPHN0cmluZz4ge1xyXG4gICAgaWYgKG9wdGlvbnMgaW5zdGFuY2VvZiBSZW5kZXJTZXNzaW9uIHx8IGNvbnRhaW5lcikge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ3JlbW92ZWQgYXBpLCBwbGVhc2UgdXNlIHJlbmRlclRvU3ZnKHsgcmVuZGVyU2Vzc2lvbiwgY29udGFpbmVyIH0pIGluc3RlYWQnKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdGhpcy53aXRoaW5PcHRpb25TZXNzaW9uKG9wdGlvbnMsIGFzeW5jIHNlc3Npb25SZWYgPT4ge1xyXG4gICAgICBsZXQgcGFydHM6IG51bWJlciB8IHVuZGVmaW5lZCA9IHVuZGVmaW5lZDtcclxuICAgICAgaWYgKG9wdGlvbnMuZGF0YV9zZWxlY3Rpb24pIHtcclxuICAgICAgICBwYXJ0cyA9IDA7XHJcbiAgICAgICAgaWYgKG9wdGlvbnMuZGF0YV9zZWxlY3Rpb24uYm9keSkge1xyXG4gICAgICAgICAgcGFydHMgfD0gMSA8PCAwO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAob3B0aW9ucy5kYXRhX3NlbGVjdGlvbi5kZWZzKSB7XHJcbiAgICAgICAgICBwYXJ0cyB8PSAxIDw8IDE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChvcHRpb25zLmRhdGFfc2VsZWN0aW9uLmNzcykge1xyXG4gICAgICAgICAgcGFydHMgfD0gMSA8PCAyO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAob3B0aW9ucy5kYXRhX3NlbGVjdGlvbi5qcykge1xyXG4gICAgICAgICAgcGFydHMgfD0gMSA8PCAzO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh0aGlzLnJlbmRlcmVyLnN2Z19kYXRhKHNlc3Npb25SZWZba09iamVjdF0sIHBhcnRzKSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHJlbmRlclN2Z0RpZmYob3B0aW9uczogUmVuZGVySW5TZXNzaW9uT3B0aW9uczxSZW5kZXJTdmdPcHRpb25zPik6IHN0cmluZyB7XHJcbiAgICBpZiAoIW9wdGlvbnMud2luZG93KSB7XHJcbiAgICAgIHJldHVybiB0aGlzLnJlbmRlcmVyLnJlbmRlcl9zdmdfZGlmZihcclxuICAgICAgICAob3B0aW9ucy5yZW5kZXJTZXNzaW9uIGFzIGFueSlba09iamVjdF0sXHJcbiAgICAgICAgMCxcclxuICAgICAgICAwLFxyXG4gICAgICAgIDFlMzMsXHJcbiAgICAgICAgMWUzMyxcclxuICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdGhpcy5yZW5kZXJlci5yZW5kZXJfc3ZnX2RpZmYoXHJcbiAgICAgIChvcHRpb25zLnJlbmRlclNlc3Npb24gYXMgYW55KVtrT2JqZWN0XSxcclxuICAgICAgb3B0aW9ucy53aW5kb3cubG8ueCxcclxuICAgICAgb3B0aW9ucy53aW5kb3cubG8ueSxcclxuICAgICAgb3B0aW9ucy53aW5kb3cuaGkueCxcclxuICAgICAgb3B0aW9ucy53aW5kb3cuaGkueSxcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICByZW5kZXJUb1N2ZyhvcHRpb25zOiBSZW5kZXJPcHRpb25zPFJlbmRlclRvU3ZnT3B0aW9ucz4pOiBQcm9taXNlPGJvb2xlYW4+IHtcclxuICAgIHJldHVybiB0aGlzLndpdGhpbk9wdGlvblNlc3Npb24ob3B0aW9ucywgYXN5bmMgc2Vzc2lvblJlZiA9PiB7XHJcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodGhpcy5yZW5kZXJlci5yZW5kZXJfc3ZnKHNlc3Npb25SZWZba09iamVjdF0sIG9wdGlvbnMuY29udGFpbmVyKSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGdldEN1c3RvbVYxKG9wdGlvbnM6IFJlbmRlckluU2Vzc2lvbk9wdGlvbnM8e30+KTogUHJvbWlzZTxhbnk+IHtcclxuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodGhpcy5yZW5kZXJlci5nZXRfY3VzdG9tcyhvcHRpb25zLnJlbmRlclNlc3Npb25ba09iamVjdF0pKTtcclxuICB9XHJcblxyXG4gIHJlc2V0U2Vzc2lvbihzZXNzaW9uOiBSZW5kZXJTZXNzaW9uKTogdm9pZCB7XHJcbiAgICByZXR1cm4gdGhpcy5yZW5kZXJlci5yZXNldChzZXNzaW9uW2tPYmplY3RdKTtcclxuICB9XHJcblxyXG4gIG1hbmlwdWxhdGVEYXRhKG9wdHM6IFJlbmRlckluU2Vzc2lvbk9wdGlvbnM8TWFuaXB1bGF0ZURhdGFPcHRpb25zPik6IHZvaWQge1xyXG4gICAgcmV0dXJuIHRoaXMucmVuZGVyZXIubWFuaXB1bGF0ZV9kYXRhKFxyXG4gICAgICAob3B0cy5yZW5kZXJTZXNzaW9uIGFzIGFueSlba09iamVjdF0gYXMgdHlwc3QuUmVuZGVyU2Vzc2lvbixcclxuICAgICAgb3B0cy5hY3Rpb24gPz8gJ3Jlc2V0JyxcclxuICAgICAgb3B0cy5kYXRhLFxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgd2l0aGluT3B0aW9uU2Vzc2lvbjxUPihcclxuICAgIG9wdGlvbnM6IFJlbmRlck9wdGlvbnM8YW55PixcclxuICAgIGZuOiAoc2Vzc2lvbjogUmVuZGVyU2Vzc2lvbikgPT4gUHJvbWlzZTxUPixcclxuICApOiBQcm9taXNlPFQ+IHtcclxuICAgIGZ1bmN0aW9uIGlzUmVuZGVyQnlDb250ZW50T3B0aW9uKG9wdGlvbnM6IFJlbmRlck9wdGlvbnM8YW55Pik6IG9wdGlvbnMgaXMgQ3JlYXRlU2Vzc2lvbk9wdGlvbnMge1xyXG4gICAgICByZXR1cm4gJ2FydGlmYWN0Q29udGVudCcgaW4gb3B0aW9ucztcclxuICAgIH1cclxuXHJcbiAgICBpZiAoJ3JlbmRlclNlc3Npb24nIGluIG9wdGlvbnMpIHtcclxuICAgICAgcmV0dXJuIGZuKG9wdGlvbnMucmVuZGVyU2Vzc2lvbiBhcyBSZW5kZXJTZXNzaW9uKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoaXNSZW5kZXJCeUNvbnRlbnRPcHRpb24ob3B0aW9ucykpIHtcclxuICAgICAgLy8gdG9kbzogcmVtb3ZlIGFueVxyXG4gICAgICByZXR1cm4gdGhpcy5ydW5XaXRoU2Vzc2lvbihvcHRpb25zIGFzIGFueSwgZm4gYXMgYW55KTtcclxuICAgIH1cclxuXHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoXHJcbiAgICAgICdJbnZhbGlkIHJlbmRlciBvcHRpb25zLCBzaG91bGQgYmUgb25lIG9mIFJlbmRlckJ5Q29udGVudE9wdGlvbnN8UmVuZGVyQnlTZXNzaW9uT3B0aW9ucycsXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgcnVuV2l0aFNlc3Npb248VD4oZm46IChzZXNzaW9uOiBSZW5kZXJTZXNzaW9uKSA9PiBQcm9taXNlPFQ+KTogUHJvbWlzZTxUPjtcclxuICBydW5XaXRoU2Vzc2lvbjxUPihcclxuICAgIG9wdGlvbnM6IENyZWF0ZVNlc3Npb25PcHRpb25zLFxyXG4gICAgZm46IChzZXNzaW9uOiBSZW5kZXJTZXNzaW9uKSA9PiBQcm9taXNlPFQ+LFxyXG4gICk6IFByb21pc2U8VD47XHJcbiAgYXN5bmMgcnVuV2l0aFNlc3Npb248VD4oYXJnMTogYW55LCBhcmcyPzogYW55KTogUHJvbWlzZTxUPiB7XHJcbiAgICBsZXQgb3B0aW9uczogUGFydGlhbDxDcmVhdGVTZXNzaW9uT3B0aW9ucz4gfCB1bmRlZmluZWQgPSBhcmcxO1xyXG4gICAgbGV0IGZuOiAoc2Vzc2lvbjogUmVuZGVyU2Vzc2lvbikgPT4gUHJvbWlzZTxUPiA9IGFyZzI7XHJcblxyXG4gICAgaWYgKCFhcmcyKSB7XHJcbiAgICAgIG9wdGlvbnMgPSB1bmRlZmluZWQ7XHJcbiAgICAgIGZuID0gYXJnMTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBzZXNzaW9uID0gdGhpcy5yZW5kZXJlci5jcmVhdGVfc2Vzc2lvbihcclxuICAgICAgLyogbW92ZWQgKi8gb3B0aW9ucyAmJiB0aGlzLmNyZWF0ZU9wdGlvbnNUb1J1c3Qob3B0aW9ucyksXHJcbiAgICApO1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgcmVzID0gYXdhaXQgZm4obmV3IFJlbmRlclNlc3Npb24odGhpcywgc2Vzc2lvbikpO1xyXG4gICAgICBzZXNzaW9uLmZyZWUoKTtcclxuICAgICAgcmV0dXJuIHJlcztcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgc2Vzc2lvbi5mcmVlKCk7XHJcbiAgICAgIHRocm93IGU7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbiJdfQ==