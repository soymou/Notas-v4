let globalCompiler = undefined;
let globalCompilerInitReady;
let isReady = false;
export function getGlobalCompiler() {
    return isReady ? globalCompiler : undefined;
}
export function createGlobalCompiler(creator, initOptions) {
    // todo: determine compiler thread-safety
    // todo: check inconsistent initOptions
    const compiler = globalCompiler || creator();
    if (globalCompilerInitReady !== undefined) {
        return globalCompilerInitReady;
    }
    return (globalCompilerInitReady = (async () => {
        isReady = true;
        await compiler.init(initOptions);
        return (globalCompiler = compiler);
    })());
}
export function withGlobalCompiler(creator, initOptions, resolve, reject) {
    const compiler = getGlobalCompiler();
    if (compiler) {
        resolve(compiler);
        return;
    }
    createGlobalCompiler(creator, initOptions).then(resolve).catch(reject);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2xvYmFsLWNvbXBpbGVyLm1qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb250cmliL2dsb2JhbC1jb21waWxlci5tdHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBR0EsSUFBSSxjQUFjLEdBQThCLFNBQVMsQ0FBQztBQUMxRCxJQUFJLHVCQUErQyxDQUFDO0FBQ3BELElBQUksT0FBTyxHQUFHLEtBQUssQ0FBQztBQUVwQixNQUFNLFVBQVUsaUJBQWlCO0lBQy9CLE9BQU8sT0FBTyxDQUFDLENBQUMsQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQztBQUM5QyxDQUFDO0FBRUQsTUFBTSxVQUFVLG9CQUFvQixDQUNsQyxPQUE0QixFQUM1QixXQUFrQztJQUVsQyx5Q0FBeUM7SUFDekMsdUNBQXVDO0lBQ3ZDLE1BQU0sUUFBUSxHQUFHLGNBQWMsSUFBSSxPQUFPLEVBQUUsQ0FBQztJQUU3QyxJQUFJLHVCQUF1QixLQUFLLFNBQVMsRUFBRSxDQUFDO1FBQzFDLE9BQU8sdUJBQXVCLENBQUM7SUFDakMsQ0FBQztJQUVELE9BQU8sQ0FBQyx1QkFBdUIsR0FBRyxDQUFDLEtBQUssSUFBSSxFQUFFO1FBQzVDLE9BQU8sR0FBRyxJQUFJLENBQUM7UUFDZixNQUFNLFFBQVEsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDakMsT0FBTyxDQUFDLGNBQWMsR0FBRyxRQUFRLENBQUMsQ0FBQztJQUNyQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUM7QUFDUixDQUFDO0FBRUQsTUFBTSxVQUFVLGtCQUFrQixDQUNoQyxPQUE0QixFQUM1QixXQUE2QyxFQUM3QyxPQUEwQyxFQUMxQyxNQUEyQjtJQUUzQixNQUFNLFFBQVEsR0FBRyxpQkFBaUIsRUFBRSxDQUFDO0lBQ3JDLElBQUksUUFBUSxFQUFFLENBQUM7UUFDYixPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDbEIsT0FBTztJQUNULENBQUM7SUFFRCxvQkFBb0IsQ0FBQyxPQUFPLEVBQUUsV0FBVyxDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUN6RSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBJbml0T3B0aW9ucyB9IGZyb20gJy4uL29wdGlvbnMuaW5pdC5tanMnO1xyXG5pbXBvcnQgdHlwZSB7IFR5cHN0Q29tcGlsZXIgfSBmcm9tICcuLi9jb21waWxlci5tanMnO1xyXG5cclxubGV0IGdsb2JhbENvbXBpbGVyOiBUeXBzdENvbXBpbGVyIHwgdW5kZWZpbmVkID0gdW5kZWZpbmVkO1xyXG5sZXQgZ2xvYmFsQ29tcGlsZXJJbml0UmVhZHk6IFByb21pc2U8VHlwc3RDb21waWxlcj47XHJcbmxldCBpc1JlYWR5ID0gZmFsc2U7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0R2xvYmFsQ29tcGlsZXIoKTogVHlwc3RDb21waWxlciB8IHVuZGVmaW5lZCB7XHJcbiAgcmV0dXJuIGlzUmVhZHkgPyBnbG9iYWxDb21waWxlciA6IHVuZGVmaW5lZDtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUdsb2JhbENvbXBpbGVyKFxyXG4gIGNyZWF0b3I6ICgpID0+IFR5cHN0Q29tcGlsZXIsXHJcbiAgaW5pdE9wdGlvbnM/OiBQYXJ0aWFsPEluaXRPcHRpb25zPixcclxuKTogUHJvbWlzZTxUeXBzdENvbXBpbGVyPiB7XHJcbiAgLy8gdG9kbzogZGV0ZXJtaW5lIGNvbXBpbGVyIHRocmVhZC1zYWZldHlcclxuICAvLyB0b2RvOiBjaGVjayBpbmNvbnNpc3RlbnQgaW5pdE9wdGlvbnNcclxuICBjb25zdCBjb21waWxlciA9IGdsb2JhbENvbXBpbGVyIHx8IGNyZWF0b3IoKTtcclxuXHJcbiAgaWYgKGdsb2JhbENvbXBpbGVySW5pdFJlYWR5ICE9PSB1bmRlZmluZWQpIHtcclxuICAgIHJldHVybiBnbG9iYWxDb21waWxlckluaXRSZWFkeTtcclxuICB9XHJcblxyXG4gIHJldHVybiAoZ2xvYmFsQ29tcGlsZXJJbml0UmVhZHkgPSAoYXN5bmMgKCkgPT4ge1xyXG4gICAgaXNSZWFkeSA9IHRydWU7XHJcbiAgICBhd2FpdCBjb21waWxlci5pbml0KGluaXRPcHRpb25zKTtcclxuICAgIHJldHVybiAoZ2xvYmFsQ29tcGlsZXIgPSBjb21waWxlcik7XHJcbiAgfSkoKSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiB3aXRoR2xvYmFsQ29tcGlsZXIoXHJcbiAgY3JlYXRvcjogKCkgPT4gVHlwc3RDb21waWxlcixcclxuICBpbml0T3B0aW9uczogUGFydGlhbDxJbml0T3B0aW9ucz4gfCB1bmRlZmluZWQsXHJcbiAgcmVzb2x2ZTogKGNvbXBpbGVyOiBUeXBzdENvbXBpbGVyKSA9PiB2b2lkLFxyXG4gIHJlamVjdD86IChlcnI6IGFueSkgPT4gdm9pZCxcclxuKSB7XHJcbiAgY29uc3QgY29tcGlsZXIgPSBnZXRHbG9iYWxDb21waWxlcigpO1xyXG4gIGlmIChjb21waWxlcikge1xyXG4gICAgcmVzb2x2ZShjb21waWxlcik7XHJcbiAgICByZXR1cm47XHJcbiAgfVxyXG5cclxuICBjcmVhdGVHbG9iYWxDb21waWxlcihjcmVhdG9yLCBpbml0T3B0aW9ucykudGhlbihyZXNvbHZlKS5jYXRjaChyZWplY3QpO1xyXG59XHJcbiJdfQ==